(function(g){var window=this;'use strict';var ah0=function(r){var l=new g.Wf("und",new g.Xd("Default","und",!0));l.captionTracks=r.captionTracks;return l},Ih8=function(r){return new g.jH(function(l,U){var F=r.length,Y=[];
if(F)for(var e=function(v,J){F--;Y[v]=J;F==0&&l(Y)},d=function(v){U(v)},K,C=0;C<r.length;C++)K=r[C],g.zQH(K,g.Fq(e,C),d);
else l(Y)})},Bk=function(r){this.W=r},Hk=function(){Bk.apply(this,arguments)},k9f=function(){Hk.apply(this,arguments)},oAr=function(){Hk.apply(this,arguments)},rg8=function(){Hk.apply(this,arguments)},$d0=function(){Hk.apply(this,arguments)},lwb=function(){Hk.apply(this,arguments)},UdY=function(){Hk.apply(this,arguments)},Fpq=function(){Bk.apply(this,arguments)},Y18=function(){Hk.apply(this,arguments)},ejY=function(){Hk.apply(this,arguments)},dd8=function(){Hk.apply(this,arguments)},OGC=function(){Hk.apply(this,
arguments)},Kpf=function(){Hk.apply(this,arguments)},C$Y=function(){Hk.apply(this,arguments)},vAC=function(){Hk.apply(this,arguments)},JgY=function(){Hk.apply(this,arguments)},mdY=function(){Hk.apply(this,arguments)},P$Y=function(){Hk.apply(this,arguments)},AgY=function(){Hk.apply(this,arguments)},Me8=function(){Hk.apply(this,arguments)},sr0=function(){Bk.apply(this,arguments)},xdq=function(){Hk.apply(this,arguments)},WpC=function(){Hk.apply(this,arguments)},Qrq=function(){Hk.apply(this,arguments)},
EAY=function(){Hk.apply(this,arguments)},ZGb=function(){Hk.apply(this,arguments)},Rj8=function(){Hk.apply(this,arguments)},hjr=function(){Hk.apply(this,arguments)},nAC=function(){Hk.apply(this,arguments)},G$C=function(){Hk.apply(this,arguments)},X0r=function(){Bk.apply(this,arguments)},iGC=function(){Bk.apply(this,arguments)},bGY=function(){Bk.apply(this,arguments)},NY0=function(){Hk.apply(this,arguments)},jr0=function(){Hk.apply(this,arguments)},q18=function(){Hk.apply(this,arguments)},TYf=function(){Hk.apply(this,
arguments)},uBf=function(){Hk.apply(this,arguments)},ygY=function(){Hk.apply(this,arguments)},BYj=function(){Hk.apply(this,arguments)},HGr=function(){Hk.apply(this,arguments)},gAj=function(){Hk.apply(this,arguments)},w0p=function(){Hk.apply(this,arguments)},Dd8=function(){Hk.apply(this,arguments)},VeY=function(){Hk.apply(this,arguments)},fwC=function(){Hk.apply(this,arguments)},S1$=function(){Hk.apply(this,arguments)},zjG=function(){Hk.apply(this,arguments)},p0p=function(){Hk.apply(this,arguments)},
teb=function(){Hk.apply(this,arguments)},LpC=function(){Hk.apply(this,arguments)},cgq=function(){Hk.apply(this,arguments)},aw8=function(){Hk.apply(this,arguments)},IwC=function(){Hk.apply(this,arguments)},k$p=function(){Hk.apply(this,arguments)},onR=function(){Hk.apply(this,arguments)},r40=function(){Hk.apply(this,arguments)},$DG=function(){Hk.apply(this,arguments)},lgp=function(){Hk.apply(this,arguments)},UD0=function(){Hk.apply(this,arguments)},FCj=function(){Bk.apply(this,arguments)},YKC=function(){Hk.apply(this,
arguments)},eEj=function(){Hk.apply(this,arguments)},dDp=function(){Hk.apply(this,arguments)},O9C=function(){Hk.apply(this,arguments)},KCG=function(){Hk.apply(this,arguments)},CMC=function(){Hk.apply(this,arguments)},vn$=function(){Hk.apply(this,arguments)},J4R=function(){Hk.apply(this,arguments)},mDq=function(){Hk.apply(this,arguments)},PMC=function(){Hk.apply(this,arguments)},A4C=function(){Hk.apply(this,arguments)},MHb=function(){Hk.apply(this,arguments)},sbR=function(){Hk.apply(this,arguments)},
xDb=function(){Hk.apply(this,arguments)},WCG=function(){Hk.apply(this,arguments)},QbY=function(){Hk.apply(this,arguments)},En0=function(){Hk.apply(this,arguments)},Z98=function(){Hk.apply(this,arguments)},REf=function(){Hk.apply(this,arguments)},hE8=function(){Hk.apply(this,arguments)},nnG=function(){Hk.apply(this,arguments)},Ga8=function(){Hk.apply(this,arguments)},Xop=function(){Hk.apply(this,arguments)},i9C=function(){Hk.apply(this,arguments)},b90=function(){Hk.apply(this,arguments)},NJf=function(){Hk.apply(this,
arguments)},jb0=function(){Hk.apply(this,arguments)},qKY=function(){Hk.apply(this,arguments)},TJp=function(){Hk.apply(this,arguments)},uf$=function(){Hk.apply(this,arguments)},y40=function(){Hk.apply(this,arguments)},BJr=function(){Hk.apply(this,arguments)},H9Y=function(){Hk.apply(this,arguments)},gnb=function(r){r=r.key||r.id;
if(!r)throw Error("Entity key is missing");return r},woR=function(){if(gt)return gt();
var r={};gt=g.Oy("PersistentEntityStoreDb",{sH:(r.EntityStore={R7:1},r.EntityAssociationStore={R7:2},r),shared:!1,upgrade:function(l,U){U(1)&&g.SN(g.HX(l,"EntityStore",{keyPath:"key"}),"entityType","entityType");U(2)&&(l=g.HX(l,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.SN(l,"byParentEntityKey","parentEntityKey"),g.SN(l,"byChildEntityKey","childEntityKey"))},
version:3});return gt()},DDb=function(r){return g.kC(woR(),r)},VHC=function(r){return g.kC((0,g.hvR)(),r)},wt=function(r){this.token=r},DZ=function(r,l){l=l===void 0?{}:l;
g.lY.call(this,g.nW0[r],Object.assign({},{name:"PESEncoderError",type:r},l));this.type=r;this.level="WARNING";Object.setPrototypeOf(this,DZ.prototype)},fgb=function(r){return new DZ("WRONG_DATA_TYPE",{Pc:r})},SKY=function(r){return r instanceof Error?new DZ("UNKNOWN_ENCODE_ERROR",{originalMessage:r.message}):new DZ("UNKNOWN_ENCODE_ERROR")},zEp=function(r){return r instanceof Error?new DZ("UNKNOWN_DECODE_ERROR",{originalMessage:r.message}):new DZ("UNKNOWN_DECODE_ERROR")},poj=function(r,l){r=r instanceof
DZ?r:l(r);
g.zz(r);throw r;},tHq=function(){},LCY=function(r,l,U){try{return r.L(l,U)}catch(F){poj(F,SKY)}},c48=function(r){r=(new TextEncoder).encode(r).subarray(0,16);
var l=new Uint8Array(16);l.set(r);return l},V5=function(r){this.W=r},IgG=function(r){var l=ag0[r];
if(l)return l;g.pZ(new g.lY("Entity model not found.",{entityType:r}))},kaf=function(r,l){this.W=r;
this.X=l;this.L={}},rKR=function(r,l){a:{r=otr(r.X,l.version);
try{var U=r.X(l.data,l.key);break a}catch(F){poj(F,zEp)}U=void 0}return U},f_=function(r,l,U){return r.W.objectStore("EntityStore").get(l).then(function(F){if(F){if(U&&F.entityType!==U)throw Error("Incorrect entity type");
return rKR(r,F)}})},SO=function(r,l,U){return U?(U=U.map(function(F){return f_(r,F,l)}),g.qZ.all(U)):r.W.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(l)).then(function(F){return F.map(function(Y){return rKR(r,Y)})})},p_=function(r,l,U){var F=gnb(l),Y=otr(r.X,1),e=Object.assign({},l);
return r.W.objectStore("EntityStore").get(F).then(function(d){if(d){if(d.entityType!==U)throw Error("Incorrect entity type");e.entityMetadata||(d=rKR(r,d),e.entityMetadata=d.entityMetadata)}}).then(function(){var d={key:F,
entityType:U,data:LCY(Y,e,F),version:1};return g.qZ.all([g.Dz(r.W.objectStore("EntityStore"),d),$8C(r,e,U)])}).then(function(){zf(r,F,U);
return F})},la8=function(r,l,U){l=l.map(function(F){return p_(r,F,U)});
return g.qZ.all(l)},tr=function(r,l,U){if(U==null?0:U.WR){var F=new Set;
return U8b(r,l,F).then(function(){for(var e=[],d=g.Q(F),K=d.next();!K.done;K=d.next())e.push(tr(r,K.value));return g.qZ.all(e).then(function(){})})}var Y=g.QN(l).entityType;
return g.qZ.all([r.W.objectStore("EntityStore").delete(l),Fu$(r,l)]).then(function(){zf(r,l,Y)})},Y28=function(r,l){return g.Lp(r.W.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(l)},function(U){return g.qZ.all([U.delete(),
Fu$(r,U.cursor.primaryKey)]).then(function(){zf(r,U.cursor.primaryKey,l);return g.pp(U)})})},e7p=function(r,l,U,F){var Y=otr(r.X,1);
return f_(r,l,F).then(function(e){if(e){e=g.i7(e,U);var d={key:l,entityType:F,data:LCY(Y,e,l),version:1};return g.qZ.all([g.Dz(r.W.objectStore("EntityStore"),d),$8C(r,e,F)])}}).then(function(){zf(r,l,F);
return l})},zf=function(r,l,U){var F=r.L[U];
F||(F=new Set,r.L[U]=F);F.add(l)},d8f=function(r,l,U){var F=gnb(l);
U=IgG(U);if(!U)return g.qZ.resolve([]);U=new U(l);r=r.W.objectStore("EntityAssociationStore");l=[];U=g.Q(U.X());for(var Y=U.next();!Y.done;Y=U.next())l.push(g.Dz(r,{parentEntityKey:F,childEntityKey:Y.value}));return g.qZ.all(l).then(function(e){return e.map(function(d){return d[1]})})},Fu$=function(r,l){return r.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l))},$8C=function(r,l,U){var F=gnb(l);
return Fu$(r,F).then(function(){return d8f(r,l,U)})},U8b=function(r,l,U){if(U.has(l))return g.qZ.resolve(void 0);
U.add(l);return Oxp(r,l).then(function(F){return r.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l)).then(function(){return F})}).then(function(F){var Y=g.qZ.resolve(void 0);
F=g.Q(F);for(var e=F.next(),d={};!e.done;d={Du:void 0},e=F.next())d.Du=e.value,Y=Y.then(function(K){return function(){return U8b(r,K.Du,U)}}(d));
return Y}).then(function(){})},Oxp=function(r,l){var U=r.W.objectStore("EntityAssociationStore");
return U.index("byParentEntityKey").getAll(IDBKeyRange.only(l)).then(function(F){var Y=[];F=g.Q(F);for(var e=F.next();!e.done;e=F.next())e=e.value,Y.push(U.index("byChildEntityKey").getAll(e.childEntityKey));return g.qZ.all(Y)}).then(function(F){var Y=[];
F=g.Q(F);for(var e=F.next();!e.done;e=F.next())e=e.value,e.length===1&&Y.push(e[0].childEntityKey);return Y})},L_=function(){},KuC=function(){this.W={};
this.W[0]=new L_;if(!g.i4("aes_pes_encoder_killswitch")){var r=this.W;try{var l=g.Uf();var U=c48(l);var F=new V5(new g.B2(U),new g.yN(U))}catch(Y){throw r=Y instanceof Error?new DZ("KEY_CREATION_FAILED",{originalMessage:Y.message}):new DZ("KEY_CREATION_FAILED"),g.zz(r),r;}r[1]=F}},otr=function(r,l){l=l===void 0?0:l;
r=r.W[l];if(!r)throw l=new DZ("INVALID_ENCODER_VERSION",{Pc:l}),g.zz(l),l;return r},ck=function(r,l){g.H.call(this);
this.token=r;this.W=l;this.observers=[];r=new g.pP.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Uf());r.onmessage=this.X.bind(this);this.channel=r},as=function(r,l,U){var F,Y,e,d;
return g.y(function(K){if(K.X==1)return g.T(K,DDb(r.token),2);if(K.X!=3)return F=K.W,g.T(K,g.wd(F,["EntityStore","EntityAssociationStore"],l,function(C){Y=new kaf(C,r.W);return U(Y)}),3);
e=K.W;Y&&(d=Y.L,Object.keys(d).length>0&&(r.channel.postMessage(d),ClG(r,d)));return K.return(e)})},Is=function(r,l,U){return as(r,{mode:"readwrite",
ag:!0},function(F){return p_(F,l,U)})},vtY=function(r,l){return as(r,{mode:"readwrite",
ag:!0},function(U){return la8(U,l,"offlineOrchestrationActionWrapperEntity")})},JKC=function(r,l){return as(r,{mode:"readwrite",
ag:!0},function(U){return tr(U,l)})},m8r=function(r){return as(r,{mode:"readwrite",
ag:!0},function(l){return Y28(l,"videoPlaybackPositionEntity")})},kG=function(r,l,U){return as(r,{mode:"readonly",
ag:!0},function(F){return f_(F,l,U)})},oA=function(r,l,U){return as(r,{mode:"readonly",
ag:!0},function(F){return SO(F,l,U)})},ClG=function(r,l){r=g.Q(r.observers);
for(var U=r.next();!U.done;U=r.next())U=U.value,U(l)},Plp=function(){var r,l,U;
return g.y(function(F){if(F.X==1)return g.QB(F,2),g.T(F,g.eJ(),4);if(F.X!=2){r=F.W;if(!r||!g.Fi()||typeof g.pP.BroadcastChannel==="undefined")return F.return();l=new KuC;return F.return(new ck(r,l))}U=g.nP(F);U instanceof Error&&g.zz(U);return F.return()})},rx=function(){AKR||(AKR=Plp());
return AKR},M1p=function(r){var l;
r=(l=r.options)==null?void 0:l.persistenceOption;return r==="ENTITY_PERSISTENCE_OPTION_PERSIST"||r==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},s7R=function(r){var l;
return g.y(function(U){return U.X==1?g.T(U,rx(),2):(l=U.W)?g.T(U,as(l,"readwrite",function(F){for(var Y={},e=g.Q(r),d=e.next(),K={};!d.done;K={QJ:void 0,A5:void 0},d=e.next())K.QJ=d.value,K.QJ.entityKey&&M1p(K.QJ)&&(K.A5=g.fr(K.QJ.payload),d=void 0,K.QJ.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(d=function(C){return function(){return p_(F,C.QJ.payload[C.A5],C.A5)}}(K)),K.QJ.type==="ENTITY_MUTATION_TYPE_DELETE"&&(d=function(C){return function(){return tr(F,C.QJ.entityKey)}}(K)),K.QJ.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(d=function(C){return function(){return e7p(F,C.QJ.entityKey,C.QJ.payload[C.A5],C.A5)}}(K)),d&&(Y[K.QJ.entityKey]=Y[K.QJ.entityKey]?Y[K.QJ.entityKey].then(d):d()));
return g.qZ.all(Object.values(Y))}),0):U.return()})},x8C=function(r){var l;
return g.y(function(U){if(U.X==1){l=r.mutations;if(!l||l.length<=0)return U.return();if(g.Jp){var F={type:"ENTITY_LOADED"};l!==void 0&&(F.payload=l);g.Jp.dispatch(F)}return g.T(U,s7R(l),2)}l.length=0;g.Wm(U)})},Wub=function(r){return r!==void 0},Q70=function(r){var l=g.D$();
l=Object.assign({},l);r=Object.assign({},r);for(var U in l)r[U]?(l[U]!==4&&(l[U]=r[U]),delete r[U]):l[U]!==2&&(l[U]=4);Object.assign(l,r);g.ELL(l);JSON.stringify(l);return l},EtC=function(r){var l,U;
return g.y(function(F){if(F.X==1)return g.T(F,g.eJ(),2);if(F.X!=3)return(l=F.W)?g.T(F,g.Sy(l),3):F.return();U=F.W;return F.return(g.wd(U,["index","media","captions"],{mode:"readwrite",ag:!0},function(Y){var e=IDBKeyRange.bound(r+"|",r+"~");Y=[Y.objectStore("index").delete(e),Y.objectStore("media").delete(e),Y.objectStore("captions").delete(e)];return g.qZ.all(Y).then(function(){})}))})},ZxC=function(){var r,l;
return g.y(function(U){if(U.X==1)return g.T(U,g.eJ(),2);if(U.X!=3){r=U.W;if(!r)throw g.NZ("rvdfd");return g.T(U,g.Sy(r),3)}l=U.W;return U.return(g.wd(l,["index","media"],{mode:"readwrite",ag:!0},function(F){var Y={};return g.zo(F.objectStore("index"),{},function(e){var d=e.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),K=g.qZ.resolve(void 0);if(d){var C=d[1];d=d[2];Y[C]=Y[C]||{};var v;Y[C][d]=g.G0B((v=e.getValue())==null?void 0:v.fmts)}else K=e.delete().then(function(){});
return g.qZ.all([g.pp(e),K]).then(function(J){return g.Q(J).next().value})}).then(function(){for(var e={},d=g.Q(Object.keys(Y)),K=d.next();!K.done;K=d.next()){K=K.value;
var C=Y[K].v;e[K]=Y[K].a&&C?1:2}var v=Q70(e);return g.iJR(F.objectStore("media"),{},function(J){var m=J.cursor.key.match(g.NZe);m&&e[m[1]]||F.objectStore("media").delete(J.cursor.key);return g.WJH(J)}).then(function(){return v})})}))})},R78=function(r,l){var U,F;
return g.y(function(Y){if(Y.X==1)return g.T(Y,g.eJ(),2);if(Y.X!=3){U=Y.W;if(!U)throw g.NZ("wct");return g.T(Y,g.Sy(U),3)}F=Y.W;return g.T(Y,g.wd(F,["captions"],{mode:"readwrite",ag:!0},function(e){var d=[];e=e.objectStore("captions");for(var K=0;K<l.length;K++){var C=g.Dz(e,l[K],r+"|"+l[K].metadata.vss_id);d.push(C)}return g.qZ.all(d)}),0)})},h70=function(r){var l,U,F;
return g.y(function(Y){if(Y.X==1)return l=IDBKeyRange.bound(r+"|",r+"~"),g.T(Y,g.eJ(),2);if(Y.X!=3){U=Y.W;if(!U)throw g.NZ("gactfv");return g.T(Y,g.Sy(U),3)}F=Y.W;return Y.return(F.getAll("captions",l))})},nt0=function(r){return g.y(function(l){g.ff(r,0);
return l.return(EtC(r))})},GVj=function(r){return{context:g.Qz(),
videoIds:r}},X$0=function(r){return{context:g.Qz(),
playlistIds:r}},ixR=function(r){return{context:g.Qz(),
offlinePlaylistSyncChecks:r}},bx8=function(){this.W=new Map},j7C=function(){NHY||(NHY=new bx8);
return NHY},q2Y=function(r,l){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:r},metadata:l,statusCode:void 0,csn:void 0,can:void 0}},THG=function(r,l,U){if(!U){var F=F===void 0?!1:F;
U=r.W.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!U||F)U=g.qt(16),r.W.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",U)}r={flowNonce:U,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:l.eventType};l.metadata&&(r.flowMetadata=l.metadata);l.statusCode!==void 0&&(r.flowEventStatus=l.statusCode);l.csn&&(r.csn=l.csn);l.can&&(r.can=l.can);g.xC("flowEvent",r,void 0)},uzC=function(r){var l,U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4,$$,Y$,L,Ae,G3,z3,RY,dR,XL,he,$0,R,d4,zp,Qk;
return g.y(function(iC){if(iC.X==1)return g.T(iC,as(r,{mode:"readonly",ag:!0},function(vb){return SO(vb,"playbackData").then(function(g4){var Tp=g4.map(function(q){return q.transfer}).filter(function(q){return!!q}),bC=g4.map(function(q){return q.offlineVideoPolicy}).filter(function(q){return!!q}),X=g4.filter(function(q){return!!q.key}).map(function(q){return g.Ea(g.QN(q.key).entityId,"downloadStatusEntity")});
Tp=SO(vb,"transfer",Tp);bC=SO(vb,"offlineVideoPolicy",bC);X=SO(vb,"downloadStatusEntity",X);var b=Tp.then(function(q){q=q.reduce(function(B,S){(S==null?0:S.offlineVideoStreams)&&B.push.apply(B,g.G(S.offlineVideoStreams));return B},[]).filter(function(B){return!!B});
return SO(vb,"offlineVideoStreams",q)});
return g.qZ.all([Tp,bC,b,X]).then(function(q){var B=g.Q(q);q=B.next().value;var S=B.next().value;var Z3=B.next().value;B=B.next().value;return[g4,q,S,Z3,B]})})}),2);
if(iC.X!=3)return l=iC.W,g.T(iC,as(r,{mode:"readonly",ag:!0},function(vb){return SO(vb,"mainDownloadsListEntity").then(function(g4){var Tp,bC;return(bC=(Tp=g4[0])==null?void 0:Tp.downloads)!=null?bC:[]})}),3);
U=iC.W;F=g.Q(l);Y=F.next().value;e=F.next().value;d=F.next().value;K=F.next().value;C=F.next().value;v=Y;J=e;m=d;P=K;A=C;M={};E={};Z={};n={};h={};N=[];u=g.Q(J);for(D=u.next();!D.done;D=u.next())(t=D.value)&&(M[t.key]=t);z=g.Q(m);for(I=z.next();!I.done;I=z.next())(U4=I.value)&&(E[U4.key]=U4);$$=g.Q(A);for(Y$=$$.next();!Y$.done;Y$=$$.next())(L=Y$.value)&&(Z[L.key]=L);Ae=g.Q(P);for(G3=Ae.next();!G3.done;G3=Ae.next())(z3=G3.value)&&(n[z3.key]=z3);RY=g.Q(U);for(dR=RY.next();!dR.done;dR=RY.next())XL=dR.value,
he=void 0,h[(he=XL.videoItem)!=null?he:""]=!0,XL.videoItem&&(R=$0=void 0,d4=(R=($0=g.QN(XL.videoItem))==null?void 0:$0.entityId)!=null?R:"",N.push({externalVideoId:d4}));zp=v.filter(function(vb){if(!vb||!vb.key||!vb.offlineVideoPolicy)return!1;vb=g.QN(vb.key).entityId;vb=g.Ea(vb,"downloadStatusEntity");var g4;return!(vb&&((g4=Z[vb])==null?void 0:g4.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
Qk=zp.map(function(vb){var g4=M[vb.transfer],Tp=[];if(g4==null?0:g4.offlineVideoStreams)for(var bC=g.Q(g4.offlineVideoStreams),X=bC.next();!X.done;X=bC.next())(X=n[X.value])&&Tp.push(X);bC=E[vb.offlineVideoPolicy];X=h;var b=vb==null?void 0:vb.playerResponseTimestamp,q=g.QN(bC.key).entityId;vb=g.Ea(q,"mainVideoEntity");if(bC.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var B="OFFLINE_VIDEO_STATE_DISABLED";bC.expirationTimestamp&&Number(bC.expirationTimestamp)<Date.now()/1E3&&(B="OFFLINE_VIDEO_STATE_EXPIRED")}else if(bC.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")B="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(g4==null?void 0:g4.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":B="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":B="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":B="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":B="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":B="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":B="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:B="OFFLINE_VIDEO_STATE_UNKNOWN"}if(B==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(g4==null?void 0:g4.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":B="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":B="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":B=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}q={id:q,videoState:B};if(g4==null?0:g4.cotn)q.cotn=g4.cotn;if(g4==null?0:g4.maximumDownloadQuality)q.selectedVideoQuality=g4==null?void 0:g4.maximumDownloadQuality;if(g4==null?0:g4.lastProgressTimeMs)q.lastProgressTimeMs=g4.lastProgressTimeMs;b&&(q.playerResponseSavedTimeMs=String(Number(b)*1E3));g4=String;b=0;Tp=g.Q(Tp);for(B=Tp.next();!B.done;B=Tp.next())if(B=B.value,B.streamsProgress){B=g.Q(B.streamsProgress);for(var S=B.next();!S.done;S=B.next()){var Z3=void 0;
b+=Number((Z3=S.value.numBytesDownloaded)!=null?Z3:0)}}q.downloadedBytes=g4(b);q.selectedOfflineMode=X[vb]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";bC.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(q.offlinePlaybackDisabledReason=bC.offlinePlaybackDisabledReason);return q});
return iC.return({offlineVideos:Qk,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:N}}})})},yKY=function(){this.locks=navigator.locks},BHq=function(){try{var r=g.LP("ytglobal.locks_");
if(r)return r;var l;if(l=navigator){var U=navigator;l="locks"in U&&!!U.locks}if(l)return g.pP.localStorage&&g.pP.localStorage.getItem("noop"),r=new yKY,g.te("ytglobal.locks_",r),r}catch(F){}},$O=function(){},HxR=function(){},gtC=function(r){if(r.includes(":"))throw Error("Invalid user cache name: "+r);
return r+":"+g.Uf("CacheStorage get")},w$p=function(){return g.y(function(r){if(l6!==void 0)return r.return(l6);
l6=new Promise(function(l){var U;return g.y(function(F){switch(F.X){case 1:return g.QB(F,2),g.T(F,U8.open("test-only"),4);case 4:return g.T(F,U8.delete("test-only"),5);case 5:g.RR(F,3);break;case 2:if(U=g.nP(F),U instanceof Error&&U.name==="SecurityError")return l(!1),F.return();case 3:l("caches"in window),g.Wm(F)}})});
return r.return(l6)})},V18=function(){return g.y(function(r){if(r.X==1)return g.T(r,w$p(),2);
if(!r.W)return r.return(void 0);D80||(D80=new HxR);return r.return(D80)})},F5=function(r,l,U){g.pZ(new g.lY("Woffle: "+r,U?{cotn:U}:""));
l instanceof Error&&g.pZ(l)},faf=function(r){var l;
return g.y(function(U){if(U.X==1)return g.T(U,uzC(r),2);l=U.W;g.xC("offlineStateSnapshot",l);g.Wm(U)})},YO=function(r){g.H.call(this);
var l=this;this.api=r;this.wv={OiG:function(){return l.W},
PNc:function(){return l.X}};
typeof g.pP.BroadcastChannel!=="undefined"&&(this.W=new g.pP.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Uf()),this.W.onmessage=this.L.bind(this),this.X=new g.pP.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Uf()),this.X.onmessage=this.K.bind(this))},eC=function(r,l){r.api.PQ("onOfflineOperationFailure",l);
var U;(U=r.W)==null||U.postMessage(l)},S2p=function(r,l,U,F){var Y=this;
this.T=r;this.V=l;this.visibility=U;this.Y=F;this.U=this.j=this.D=this.L=this.W=!1;this.K=new g.F1(function(){Y.GQ()});
this.wv={ql:function(){return Y.X},
GQ:function(){Y.GQ()},
mXa:function(){return Y.K}};
this.visibility.subscribe("visibilitystatechange",function(){Y.W$()})},z78=function(r){if(!r.L&&!r.W){var l=BHq();
if(l){r.L=!0;var U=g.Uf("OfflineLockManager");l.request("woffle_orchestration_leader:"+U,{},function(){var F,Y,e,d;return g.y(function(K){switch(K.X){case 1:return g.QB(K,2),r.X=new g.W$,r.W=!0,r.L=!1,g.T(K,r.T(),4);case 4:return g.T(K,r.X.promise,5);case 5:g.RR(K,0);break;case 2:F=g.nP(K),((e=(Y=r).Y)==null?0:e.call(Y,"wo_relinquish_leadership_on_lock_request_error"))||r.GQ(),F instanceof Error&&(d=F,d.args=[{name:"WoLockManagerError",kA:F.name}],g.zz(d)),g.Wm(K)}})})}}},p$8=function(r){r.W&&(r.U=
!0,dx(r))},t18=function(r,l){r.W&&(r.D=l,dx(r))},LuG=function(r,l){r.W&&(r.j=l,dx(r))},dx=function(r){r.j&&r.D&&r.U&&r.visibility.isBackground()?g.Yl(r.K,6E4):r.K.stop()},O8=function(r){var l;
r.offlineDeleteReason=(l=r.offlineDeleteReason)!=null?l:"OFFLINE_DELETE_REASON_UNKNOWN";var U;r.offlineModeType=(U=r.offlineModeType)!=null?U:"OFFLINE_NOW";g.xC("offlineDeleteEvent",r)},Kq=function(r,l){var U=l.videoId;
var F=l.cj;l=l.offlineModeType;r.encryptedVideoId=U;r.cotn=F==null?void 0:F.cotn;r.offlineabilityFormatType=F==null?void 0:F.maximumDownloadQuality;var Y;r.isRefresh=(Y=F==null?void 0:F.isRefresh)!=null?Y:!1;var e;r.softErrorCount=(e=F==null?void 0:F.transferRetryCount)!=null?e:0;r.offlineModeType=l!=null?l:"OFFLINE_NOW";(r.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&r.statusType==="UNKNOWN_STATUS_TYPE"||!r.transferStatusType&&!r.statusType)&&g.pZ(Error("Woffle unknown transfer status"));
g.xC("offlineTransferStatusChanged",r)},cK$=function(r){Kq({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},r)},aaC=function(r,l,U,F){F={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!F};l&&U&&(l=Math.floor(l/1024).toFixed(),U=Math.floor(U/1024).toFixed(),F.alreadyDownloadedKbytes=l,F.totalFetchedKbytes=l,F.totalContentKbytes=U);Kq(F,r)},Ia0=function(r){Kq({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},r)},kVq=function(r){Kq({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},r)},oar=function(r){switch(r){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Cq=function(r){var l,U,F;
return((F=(l=r.actionMetadata)==null?void 0:(U=l.retryScheduleIntervalsInSeconds)==null?void 0:U.length)!=null?F:0)>0},vR=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!r.entityKey},Jo=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!r.entityKey},mj=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!r.entityKey},rzY=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!r.entityKey},
PR=function(r,l,U,F,Y){Y=Y===void 0?!1:Y;
var e,d,K,C,v,J;return g.y(function(m){if(m.X==1)return e=g.Ea(r,l),d=g.Ea(r,"downloadStatusEntity"),g.T(m,as(U,{mode:"readonly",ag:!0},function(P){return g.qZ.all([f_(P,e,l),f_(P,d,"downloadStatusEntity")])}),2);
K=m.W;C=K.length?K[0]:void 0;if(!C)return m.FT(0);v=$_$;if(J=K.length>1?K[1]:void 0){if(J.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!Y)return m.return();J.downloadState=F}else J={key:d,downloadState:F};g.I3(C,v,J);return g.T(m,as(U,{mode:"readwrite",ag:!0},function(P){return g.qZ.all([p_(P,C,l),p_(P,J,"downloadStatusEntity")])}),0)})},Ao=function(r,l){return r.actionType===l.actionType&&r.entityKey===l.entityKey},M4=function(r,l){if(r&&r.transferState!=="TRANSFER_STATE_COMPLETE"&&r.transferState!==
"TRANSFER_STATE_FAILED"){var U=g.QN(r.key).entityId;
Kq({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:U,cj:r,offlineModeType:l})}},s8=function(r){if(!r||!r.thumbnails)return[];
var l=[];r=g.Q(r.thumbnails);for(var U=r.next();!U.done;U=r.next())U=U.value,U.url&&l.push(U.url);return l},lFC=function(r,l,U){U=U===void 0?[]:U;
var F,Y,e,d,K,C,v,J,m,P,A,M,E;return g.y(function(Z){if(Z.X==1)return U.length?g.T(Z,oA(r,l),2):Z.return([]);F=Z.W;Y=new Set;e=g.Q(F);for(d=e.next();!d.done;d=e.next())if(K=d.value,C=K.id||K.key)v=g.QN(C).entityId,Y.add(v);J=[];m=g.Q(U);for(P=m.next();!P.done;P=m.next())A=P.value,M=A.offlineVideoData,E=void 0,((E=M)==null?0:E.videoId)&&!Y.has(M.videoId)&&J.push(A);return Z.return(J)})},U_C=function(r,l,U){return new g.l9(r,{cotn:l,
raw_player_response:U,download_media:!0,start:Infinity,disable_watch_next:!0})},FQp=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},xO=function(r,l,U,F,Y,e,d,K,C,v,J){this.entityType=r;
this.actionId=l;this.action=U;this.parentActionId=F;this.rootActionId=Y===void 0?l:Y;this.childActionIds=e;this.prereqActionId=d;this.postreqActionIds=K;this.hasChildActionFailed=v;this.retryScheduleIndex=0;this.W=J||Date.now();this.retryScheduleIndex=C||0},WR=function(r){if(!r.key)throw Error("Entity key is required.");
if(!r.actionProto)throw Error("OfflineOrchestrationAction is required.");var l=g.QN(r.key),U=g.QN(r.actionProto.entityKey);return new xO(U.entityType,l.entityId,r.actionProto,r.parentActionId,r.rootActionId,r.childActionIds,r.prereqActionId,r.postreqActionIds,r.retryScheduleIndex,r.hasChildActionFailed,Number(r.enqueueTimeSec)*1E3)},QR=function(r){return{key:g.Ea(r.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:r.action,parentActionId:r.parentActionId,rootActionId:r.rootActionId,childActionIds:r.childActionIds,prereqActionId:r.prereqActionId,postreqActionIds:r.postreqActionIds,retryScheduleIndex:r.retryScheduleIndex,hasChildActionFailed:r.hasChildActionFailed,enqueueTimeSec:(r.W/1E3).toFixed()}},Yef=function(){var r;
return g.y(function(l){return l.X==1?g.T(l,V18(),2):(r=l.W)?l.return(r.delete("yt-player-local-img")):l.return(!0)})},E8=function(r){var l,U;
return g.y(function(F){if(F.X==1)return g.T(F,V18(),2);if(F.X!=3){l=F.W;if(!l)throw Error("Cache API not supported");return r.length?g.T(F,l.open("yt-player-local-img"),3):F.return()}U=F.W;return g.T(F,Promise.all(r.map(function(Y){return U.delete(Y)})),0)})},Zp=function(r){var l,U;
return g.y(function(F){if(F.X==1)return g.T(F,V18(),2);if(F.X!=3){l=F.W;if(!l)throw Error("Cache API not supported");return r.length?g.T(F,l.open("yt-player-local-img"),3):F.return()}U=F.W;return g.T(F,U.addAll(r),0)})},RA=function(r,l,U,F,Y){var e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4,$$,Y$,L,Ae,G3,z3,RY,dR,XL,he;
return g.y(function($0){switch($0.X){case 1:return e=g.Ea(r,"mainVideoEntity"),d=g.Ea(r,"ytMainChannelEntity"),K=g.Ea(r,"transfer"),C=g.Ea(r,"videoDownloadContextEntity"),g.T($0,as(l,{mode:"readonly",ag:!0},function(R){return g.qZ.all([f_(R,e,"mainVideoEntity"),f_(R,d,"ytMainChannelEntity"),f_(R,K,"transfer"),f_(R,C,"videoDownloadContextEntity"),SO(R,"ytMainChannelEntity"),SO(R,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:v=$0.W;J=g.Q(v);m=J.next().value;P=J.next().value;A=J.next().value;M=J.next().value;E=J.next().value;Z=J.next().value;n=m;h=P;N=A;u=M;D=E;t=Z;if(!n&&!h){$0.FT(3);break}z=n?s8(n.thumbnail):[];if(!h){I=[];$0.FT(4);break}return g.T($0,et0(h,D),5);case 5:I=$0.W;case 4:return U4=I,g.T($0,E8(z.concat(U4)),3);case 3:$$=[];Y$=g.Ea(r,"downloadStatusEntity");L=g.Q(t);for(Ae=L.next();!Ae.done;Ae=L.next())G3=Ae.value,z3=g.QN(G3.key).entityId,RY=WR(G3),dR=g.QN(RY.action.entityKey).entityId,z3!==r&&dR!==
r||Ao(U,G3.actionProto)||$$.push(G3.key);return g.T($0,as(l,{mode:"readwrite",ag:!0},function(R){var d4=$$.map(function(zp){return tr(R,zp)});
d4.push(tr(R,e,{WR:!0}));d4.push(tr(R,Y$,{WR:!0}));return g.qZ.all(d4)}),7);
case 7:he=(XL=u)==null?void 0:XL.offlineModeType,Y&&(O8(Y),Y.offlineModeType&&(he=Y.offlineModeType)),M4(N,he),eC(F,{entityKey:e,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Wm($0)}})},KQ0=function(r,l,U,F){var Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4,$$,Y$,L,Ae,G3,z3,RY,dR,XL,he,$0,R,d4,zp,Qk,iC,vb,g4,Tp,bC,X,b,q,B,S,Z3,r4,s4;
return g.y(function(lz){switch(lz.X){case 1:return Y=g.Ea(r,"mainPlaylistEntity"),e=g.Ea(r,"ytMainChannelEntity"),g.T(lz,as(l,{mode:"readonly",ag:!0},function(bz){return g.qZ.all([f_(bz,Y,"mainPlaylistEntity"),f_(bz,e,"ytMainChannelEntity"),SO(bz,"mainPlaylistEntity"),SO(bz,"mainDownloadsListEntity"),SO(bz,"ytMainChannelEntity"),SO(bz,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=lz.W;K=g.Q(d);C=K.next().value;v=K.next().value;J=K.next().value;m=K.next().value;P=K.next().value;A=K.next().value;M=C;E=v;Z=J;n=m;h=P;N=A;if(!M&&!E){lz.FT(3);break}u=M?d_$(M):[];if(!E){D=[];lz.FT(4);break}return g.T(lz,et0(E,h),5);case 5:D=lz.W;case 4:return t=D,g.T(lz,E8(u.concat(t)),3);case 3:z=[];I=new Map;if(!M){lz.FT(7);break}return g.T(lz,O0f(M,Z,n),8);case 8:z=lz.W;U4=g.Q(z);for($$=U4.next();!$$.done;$$=U4.next())Y$=$$.value,I.set(Y$,{videoId:Y$,playlistId:r,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.T(lz,as(l,{mode:"readonly",ag:!0},function(bz){return g.qZ.all([SO(bz,"transfer"),SO(bz,"videoDownloadContextEntity")])}),9);
case 9:L=lz.W;Ae=g.Q(L);G3=Ae.next().value;z3=Ae.next().value;RY=G3;dR=z3;XL=g.Q(RY);for(he=XL.next();!he.done;he=XL.next())$0=he.value,R=g.QN($0.key).entityId,(d4=I.get(R))&&$0&&(d4.cotn=$0.cotn);zp=g.Q(dR);for(Qk=zp.next();!Qk.done;Qk=zp.next())iC=Qk.value,vb=g.QN(iC.key).entityId,(g4=I.get(vb))&&iC&&(g4.offlineModeType=iC.offlineModeType);case 7:Tp=[];bC=g.Q(N);for(X=bC.next();!X.done;X=bC.next())b=X.value,q=g.QN(b.key).entityId,B=WR(b),q!==r&&B.rootActionId!==r||Ao(U,b.actionProto)||Tp.push(b.key);
S=g.Ea(r,"mainPlaylistEntity");return g.T(lz,as(l,{mode:"readwrite",ag:!0},function(bz){var cm=Tp.map(function(EY){return tr(bz,EY)});
cm.push(tr(bz,S,{WR:!0}));return g.qZ.all(cm)}),10);
case 10:if(!M){lz.FT(0);break}z.reverse();if(!z){lz.FT(0);break}Z3=g.Q(z);r4=Z3.next();case 13:if(r4.done){lz.FT(0);break}s4=r4.value;return g.T(lz,RA(s4,l,U,F,I.get(s4)),14);case 14:r4=Z3.next(),lz.FT(13)}})},va0=function(r,l,U,F){var Y,e,d,K,C,v,J,m,P;
return g.y(function(A){if(A.X==1)return Y=g.Ea("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),e=new Map,g.T(A,as(r,{mode:"readwrite",ag:!0},function(M){var E=SO(M,"transfer"),Z=SO(M,"offlineOrchestrationActionWrapperEntity"),n=SO(M,"videoDownloadContextEntity"),h=f_(M,Y,"mainDownloadsListEntity");return g.qZ.all([E,Z,n,h]).then(function(N){N=g.Q(N);var u=N.next().value;var D=N.next().value;var t=N.next().value;var z=N.next().value;N=CU0.map(function(U4){return Y28(M,U4)});
D=g.Q(D);for(var I=D.next();!I.done;I=D.next())I=I.value,Ao(l,I.actionProto)||N.push(tr(M,I.key,{WR:!0}));z&&(z.downloads=[],N.push(p_(M,z,"mainDownloadsListEntity")));if(t)for(t=g.Q(t),z=t.next();!z.done;z=t.next())z=z.value,D=g.QN(z.key).entityId,D=g.Ea(D,"transfer"),e.set(D,z.offlineModeType);return g.qZ.all(N).then(function(){return u})})}),2);
d=A.W;K=g.Q(d);for(C=K.next();!C.done;C=K.next())v=C.value,M4(v,e.get(v.key)),J=g.QN(v.key).entityId,m={videoId:J,offlineDeleteReason:F,cotn:v.cotn,offlineModeType:e.get(v.key)},O8(m),P=g.Ea(J,"mainVideoEntity"),eC(U,{entityKey:P,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.T(A,Yef(),0)})},d_$=function(r,l){var U=[];
if(r.thumbnailStyleData){r=g.Q(r.thumbnailStyleData);for(var F=r.next();!F.done;F=r.next()){var Y=void 0,e=void 0,d=void 0;U=U.concat(s8((Y=F.value)==null?void 0:(e=Y.value)==null?void 0:(d=e.collageThumbnail)==null?void 0:d.coverThumbnail))}}l=s8(l);return U.concat(l)},O0f=function(r,l,U){var F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4;
return g.y(function($$){F=[];Y=new Set;if(U.length)for(e=g.Q(U),d=e.next();!d.done;d=e.next())if(K=d.value,C=void 0,(C=K.downloads)==null?0:C.length)for(v=g.Q(K.downloads),J=v.next();!J.done;J=v.next())m=J.value,m.videoItem&&(P=g.QN(m.videoItem).entityId,Y.add(P));if(r.videos){A=g.Q(r.videos);for(M=A.next();!M.done;M=A.next())E=M.value,Z=JSON.parse(g.QN(E).entityId),Z.videoId&&!Y.has(Z.videoId)&&F.push(Z.videoId);n=g.Q(l);for(h=n.next();!h.done;h=n.next())if(N=h.value,N.key!==r.key&&(u=N.videos))for(D=
g.Q(u),t=D.next();!t.done;t=D.next())z=t.value,I=JSON.parse(g.QN(z).entityId),I.videoId&&(U4=F.indexOf(I.videoId),U4!==-1&&F.splice(U4,1))}return $$.return(F)})},et0=function(r,l){var U,F,Y,e,d,K,C,v;
return g.y(function(J){U=s8(r.avatar);F=g.Q(l);for(Y=F.next();!Y.done;Y=F.next())if(e=Y.value,e.id!==r.id)for(d=g.Q(s8(e.avatar)),K=d.next();!K.done;K=d.next())C=K.value,v=U.indexOf(C),v!==-1&&U.splice(v,1);return J.return(U)})},JzY=function(r){var l;
return g.y(function(U){l=g.V(r.frameworkUpdates,ho);return r.frameworkUpdates&&l?g.T(U,x8C(l),0):U.return()})},PUf=function(r){var l;
if((l=r.onResponseReceivedActions)!=null&&l.length){var U;r=(U=g.V(g.V(r.onResponseReceivedActions[0],m_f),g.ZRC))==null?void 0:U.actions;if(r!=null&&r.length)return r}},Az8=function(r){var l,U,F;
return g.y(function(Y){if(Y.X==1)return r?g.T(Y,kG(r,g.DS,"mainDownloadsListEntity"),2):Y.return([]);l=Y.W;return((U=l)==null?0:(F=U.downloads)==null?0:F.length)?Y.return(l.downloads.map(function(e){var d;return(d=e.videoItem)!=null?d:""})):Y.return([])})},sNb=function(r,l){var U;
return g.y(function(F){return F.X==1?g.T(F,M68(r,l),2):(U=F.W)?g.T(F,as(r,{mode:"readwrite",ag:!0},function(Y){var e=[p_(Y,U.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];U.mainDownloadsListEntity&&e.push(p_(Y,U.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.qZ.all(e)}),0):F.FT(0)})},M68=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N;
return g.y(function(u){if(u.X==1)return U=g.Ea("main_downloads_library_id","mainDownloadsLibraryEntity"),F=g.Ea("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.T(u,as(r,{mode:"readonly",ag:!0},function(D){return g.qZ.all([f_(D,U,"mainDownloadsLibraryEntity"),f_(D,F,"mainDownloadsListEntity")])}),2);
Y=u.W;e=g.Q(Y);d=e.next().value;K=e.next().value;C=d;v=K;C||(C={id:U});J=g.Q(l);for(m=J.next();!m.done;m=J.next())if(P=m.value,P===g.DS){if(C.smartDownloadsList)return u.return();C.smartDownloadsList=P}else if(A=g.QN(P).entityType,M={},A==="mainPlaylistEntity"?M.playlistItem=P:A==="mainVideoEntity"&&(M.videoItem=P),!g.aY(M)){E=void 0;if((E=v)==null?0:E.downloads){Z=!1;n=g.Q(v.downloads);for(h=n.next();!h.done;h=n.next())if(N=h.value,N.playlistItem===P||N.videoItem===P){Z=!0;break}Z||v.downloads.push(M)}else v=
{id:F,downloads:[M]};C.downloadsList=F}return u.return({mainDownloadsLibraryEntity:C,mainDownloadsListEntity:v})})},x_Y=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z;
return g.y(function(n){if(n.X==1)return U=g.Ea("main_downloads_library_id","mainDownloadsLibraryEntity"),F=g.Ea("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.T(n,as(r,{mode:"readonly",ag:!0},function(h){return g.qZ.all([f_(h,U,"mainDownloadsLibraryEntity"),f_(h,F,"mainDownloadsListEntity"),f_(h,g.DS,"mainDownloadsListEntity")])}),2);
Y=n.W;e=g.Q(Y);d=e.next().value;K=e.next().value;C=e.next().value;v=d;J=K;m=C;if(!v)return n.FT(0);if(l===g.DS&&((P=m)==null?0:P.downloads))m.downloads=[];else if((A=J)==null?0:A.downloads)for(M=g.QN(l).entityType,E=0;E<J.downloads.length;E++)if(Z=J.downloads[E],M==="mainVideoEntity"&&Z.videoItem===l){J.downloads.splice(E,1);break}else if(M==="mainPlaylistEntity"&&Z.playlistItem===l){J.downloads.splice(E,1);break}return g.T(n,as(r,{mode:"readwrite",ag:!0},function(h){var N=[p_(h,v,"mainDownloadsLibraryEntity")];
J&&N.push(p_(h,J,"mainDownloadsListEntity"));m&&N.push(p_(h,m,"mainDownloadsListEntity"));return g.qZ.all(N)}),0)})},nq=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P;
return g.y(function(A){if(A.X==1)return U=g.Ea(l,"transfer"),F=g.Ea(l,"videoDownloadContextEntity"),g.T(A,as(r,{mode:"readonly",ag:!0},function(M){return g.qZ.all([f_(M,U,"transfer"),f_(M,F,"videoDownloadContextEntity")])}),2);
Y=A.W;e=g.Q(Y);d=e.next().value;K=e.next().value;C=d;v=K;P={videoId:l,cotn:(J=C)==null?void 0:J.cotn,offlineModeType:(m=v)==null?void 0:m.offlineModeType};return A.return(P)})},GX=function(r,l,U,F,Y){var e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I;
return g.y(function(U4){switch(U4.X){case 1:return e=g.Ea(r,"musicTrack"),d=g.Ea(r,"transfer"),g.T(U4,as(l,{mode:"readonly",ag:!0},function($$){return g.qZ.all([f_($$,e,"musicTrack"),f_($$,d,"transfer"),SO($$,"musicTrack"),SO($$,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:K=U4.W;C=g.Q(K);v=C.next().value;J=C.next().value;m=C.next().value;P=C.next().value;A=v;M=J;E=m;Z=P;if(!A){U4.FT(3);break}return g.T(U4,WQG(A,E),4);case 4:return n=U4.W,g.T(U4,E8(n),3);case 3:h=[];N=g.Q(Z);for(u=N.next();!u.done;u=N.next())D=u.value,t=g.QN(D.key).entityId,z=WR(D),I=g.QN(z.action.entityKey).entityId,t!==r&&I!==r||Ao(U,D.actionProto)||h.push(D.key);return g.T(U4,as(l,{mode:"readwrite",ag:!0},function($$){var Y$=h.map(function(L){return tr($$,L)});
Y$.push(tr($$,e,{WR:!0}));return g.qZ.all(Y$)}),6);
case 6:M4(M),Y&&O8(Y),eC(F,{entityKey:e,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Wm(U4)}})},X5=function(r,l,U,F,Y){var e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4,$$,Y$,L,Ae,G3,z3,RY,dR,XL,he,$0,R,d4,zp,Qk;
return g.y(function(iC){switch(iC.X){case 1:return e=g.Ea(r,l),d=g.Ea("music_downloads_library_id","musicDownloadsLibraryEntity"),g.T(iC,as(U,{mode:"readonly",ag:!0},function(vb){return g.qZ.all([f_(vb,e,l),f_(vb,d,"musicDownloadsLibraryEntity"),SO(vb,l),SO(vb,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:K=iC.W;C=g.Q(K);v=C.next().value;J=C.next().value;m=C.next().value;P=C.next().value;A=v;M=J;E=m;Z=P;if(!A){iC.FT(3);break}return g.T(iC,WQG(A,E),4);case 4:return n=iC.W,g.T(iC,E8(n),3);case 3:h=[];N=new Map;if(!A){iC.FT(6);break}return g.T(iC,QNY(A,E,M),7);case 7:h=iC.W;u=g.Q(h);for(D=u.next();!D.done;D=u.next())t=D.value,z=g.QN(t).entityId,N.set(z,{videoId:z,playlistId:r,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.T(iC,oA(U,"transfer"),8);case 8:for(I=iC.W,U4=
g.Q(I),$$=U4.next();!$$.done;$$=U4.next())Y$=$$.value,L=g.QN(Y$.key).entityId,(Ae=N.get(L))&&Y$&&(Ae.cotn=Y$.cotn);case 6:G3=[];z3=g.Q(Z);for(RY=z3.next();!RY.done;RY=z3.next())dR=RY.value,XL=g.QN(dR.key).entityId,he=WR(dR),XL!==r&&he.rootActionId!==r||Ao(F,dR.actionProto)||G3.push(dR.key);$0=g.Ea(r,l);return g.T(iC,as(U,{mode:"readwrite",ag:!0},function(vb){var g4=G3.map(function(Tp){return tr(vb,Tp)});
g4.push(tr(vb,$0,{WR:!0}));return g.qZ.all(g4)}),9);
case 9:if(!A){iC.FT(0);break}h.reverse();if(!h.length){iC.FT(0);break}R=g.Q(h);d4=R.next();case 12:if(d4.done){iC.FT(0);break}zp=d4.value;Qk=g.QN(zp).entityId;if(!Qk){iC.FT(13);break}return g.T(iC,GX(Qk,U,F,Y,N.get(Qk)),13);case 13:d4=R.next(),iC.FT(12)}})},i6=function(r,l,U){var F,Y,e,d,K,C,v;
return g.y(function(J){if(J.X==1)return g.T(J,as(r,{mode:"readwrite",ag:!0},function(m){var P=SO(m,"transfer"),A=SO(m,"offlineOrchestrationActionWrapperEntity");return g.qZ.all([P,A]).then(function(M){M=g.Q(M);var E=M.next().value;var Z=M.next().value;M=Ear.map(function(u){return Y28(m,u)});
Z=g.Q(Z);for(var n=Z.next();!n.done;n=Z.next()){n=n.value;var h=g.QN(n.actionProto.entityKey).entityType==="musicTrack",N=n.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Ao(l,n.actionProto)||h&&(!h||N)||M.push(tr(m,n.key,{WR:!0}))}return g.qZ.all(M).then(function(){return E})})}),2);
F=J.W;Y=g.Q(F);for(e=Y.next();!e.done;e=Y.next())d=e.value,M4(d),K=g.QN(d.key).entityId,C={videoId:K,offlineDeleteReason:void 0,cotn:d.cotn},O8(C),v=g.Ea(K,"musicTrack"),eC(U,{entityKey:v,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.T(J,Yef(),0)})},Z0Y=function(r){for(var l,U=g.Q(r.additionalMetadatas),F=U.next();!F.done;F=U.next())F=F.value,F.offlineMusicVideoData&&(l=F.offlineMusicVideoData);
var Y,e,d,K,C;return{id:g.Ea(r.videoId,"musicTrack"),videoId:r.videoId,title:r.title,thumbnailDetails:r.thumbnail,lengthMs:String(Number(r.lengthSeconds)*1E3),albumTitle:(Y=l)==null?void 0:Y.releaseTitle,musicVideoType:(e=l)==null?void 0:e.musicVideoType,contentRating:{explicitType:(d=l)==null?void 0:d.explicitType},artistNames:((K=l)==null?void 0:K.byline)||((C=l)==null?void 0:C.channelName),downloadMetadata:g.Ea(r.videoId,"musicTrackDownloadMetadataEntity")}},QNY=function(r,l,U){var F,Y,e,d,K,C,
v,J,m,P,A,M,E,Z,n,h,N,u;
return g.y(function(D){F=[];Y=new Set;if((e=U)==null?0:(d=e.downloadedTracks)==null?0:d.length)for(K=g.Q(U.downloadedTracks),C=K.next();!C.done;C=K.next())v=C.value,Y.add(v);if(r.tracks){J=g.Q(r.tracks);for(m=J.next();!m.done;m=J.next())P=m.value,Y.has(P)||F.push(P);A=g.Q(l);for(M=A.next();!M.done;M=A.next())if(E=M.value,E.id!==r.id&&(Z=E.tracks))for(n=g.Q(Z),h=n.next();!h.done;h=n.next())N=h.value,u=F.indexOf(N),u!==-1&&F.splice(u,1)}return D.return(F)})},WQG=function(r,l){var U,F,Y,e,d,K,C,v;
return g.y(function(J){U=s8(r.thumbnailDetails);F=g.Q(l);for(Y=F.next();!Y.done;Y=F.next())if(e=Y.value,e.id!==r.id)for(d=g.Q(s8(e.thumbnailDetails)),K=d.next();!K.done;K=d.next())C=K.value,v=U.indexOf(C),v!==-1&&U.splice(v,1);return J.return(U)})},Rtq=function(r,l){var U,F,Y,e,d,K,C,v,J;
return g.y(function(m){if(m.X==1)return U=g.Ea("music_downloads_library_id","musicDownloadsLibraryEntity"),g.T(m,kG(r,U,"musicDownloadsLibraryEntity"),2);(F=m.W)||(F={id:U});Y=g.QN(l).entityType;Y==="musicTrack"?(e=F.downloadedTracks)!=null&&e.includes(l)||(F.downloadedTracks=((d=F.downloadedTracks)!=null?d:[]).concat(l)):Y==="musicPlaylist"?(K=F.downloadedPlaylists)!=null&&K.includes(l)||(F.downloadedPlaylists=((C=F.downloadedPlaylists)!=null?C:[]).concat(l)):Y!=="musicAlbumRelease"||(v=F.downloadedAlbumReleases)!=
null&&v.includes(l)||(F.downloadedAlbumReleases=((J=F.downloadedAlbumReleases)!=null?J:[]).concat(l));return g.T(m,Is(r,F,"musicDownloadsLibraryEntity"),0)})},htf=function(r,l){var U,F,Y,e,d,K,C;
return g.y(function(v){if(v.X==1)return U=g.Ea("music_downloads_library_id","musicDownloadsLibraryEntity"),g.T(v,kG(r,U,"musicDownloadsLibraryEntity"),2);F=v.W;if(!F)return v.FT(0);Y=g.QN(l).entityType;Y==="musicTrack"?e=F.downloadedTracks:Y==="musicPlaylist"&&(e=F.downloadedPlaylists);if((d=e)==null?0:d.length)for(K=0;K<e.length;K++)if(C=e[K],C===l){e.splice(K,1);break}return g.T(v,Is(r,F,"musicDownloadsLibraryEntity"),0)})},naC=function(r){var l=r.videos;
r=[];var U=[];if(l){l=g.Q(l);for(var F=l.next();!F.done;F=l.next()){var Y=F.value.offlineVideoData.videoId;F=g.Ea(Y,"musicTrack");Y=g.Ea(Y,"musicTrackDownloadMetadataEntity");r.push(F);U.push(Y)}}return{F_:r,Z5:U}},b6=function(r,l,U){l={track:Z0Y(l)};
U&&(l.playlistId=U);if(r=g.V(r.actionMetadata,Gdb))l.maximumDownloadQuality=r.maximumDownloadQuality;return{musicTrackEntityActionMetadata:l}},i0p=function(r){var l,U,F,Y,e,d,K,C;
return g.y(function(v){switch(v.X){case 1:return l=g.sA(),U=GVj(r),F=g.Re(Xsj),g.QB(v,2),e={Qt:!0},g.T(v,g.e5(l,U,F,void 0,e),4);case 4:Y=v.W;g.RR(v,3);break;case 2:d=g.nP(v);if(d instanceof g.PA)throw K="GetOffline network manager error: "+d.message,F5(K,d),Error(K);F5("GetOffline fetch request error",d);throw Error("GetOffline fetch request error");case 3:C=N4(Y);if(!Y)throw F5("Network request failed"),Error("Network request failed");if(C!==void 0)jC(C);else if(!Y.videos||!Y.videos.length)throw F5("No data"),
Error("No data");return v.return(Y.videos.map(function(J){return J.offlineVideoData}))}})},b0C=function(r){var l,U,F,Y,e,d,K,C;
return g.y(function(v){switch(v.X){case 1:return l=g.sA(),U=X$0(r),F=g.Re(Xsj),g.QB(v,2),e={Qt:!0},g.T(v,g.e5(l,U,F,void 0,e),4);case 4:Y=v.W;g.RR(v,3);break;case 2:d=g.nP(v);if(d instanceof g.PA)throw K="GetOffline network manager error for playlist: "+d.message,F5(K,d),Error(K);F5("GetOffline fetch request error for playlist",d);throw Error("GetOffline fetch request error for playlist");case 3:C=N4(Y);if(!Y)throw F5("Network request failed for playlist"),Error("Network request failed for playlist");
if(C!==void 0)jC(C,"playlist");else if(!Y.playlists||!Y.playlists.length)throw F5("No data for playlist"),Error("No data for playlist");return v.return(Y.playlists.map(function(J){return J.offlinePlaylistData}))}})},jNC=function(r,l,U,F){var Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4,$$,Y$,L,Ae,G3,z3,RY,dR;
return g.y(function(XL){switch(XL.X){case 1:return g.T(XL,rx(),2);case 2:Y=XL.W;if(!Y)return XL.return([]);e=[];if((d=F)==null?0:d.length){e=F;XL.FT(3);break}return g.T(XL,oA(Y,"mainPlaylistEntity"),4);case 4:e=XL.W;case 3:if(!e.length)return XL.return([]);K=[];C=Date.now()/1E3;v=g.Q(e);J=v.next();case 5:if(J.done)return K.length?g.T(XL,Nc$(K),10):XL.return([]);m=J.value;if(!m.downloadState){P=void 0;XL.FT(8);break}return g.T(XL,kG(Y,m.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:P=
XL.W;case 8:A=P;M=void 0;Z=(E=(M=m)==null?void 0:M.entityMetadata)&&E.nextAutoRefreshIntervalSeconds?Number(E.nextAutoRefreshIntervalSeconds):NaN;n=Number.isNaN(Z)?r:Z;N=h=void 0;u=((h=A)==null?0:h.lastSyncedTimestampMillis)?Number((N=A)==null?void 0:N.lastSyncedTimestampMillis)/1E3:0;t=D=void 0;z=((D=A)==null?0:D.addedTimestampMillis)?Number((t=A)==null?void 0:t.addedTimestampMillis)/1E3:0;if(U||!E||u+n<=C){I=[];U4=void 0;if((U4=m.videos)==null?0:U4.length)for($$=g.Q(m.videos),Y$=$$.next();!Y$.done;Y$=
$$.next())L=Y$.value,Ae=JSON.parse(g.QN(L).entityId),Ae.videoId&&I.push(Ae.videoId);G3="0";E&&(z3=void 0,G3=String(Number((z3=E.offlineLastModifiedTimestampSeconds)!=null?z3:0).toFixed()));RY={playlistId:m.playlistId,videoIds:I,offlineLastModifiedTimestamp:G3,autoSync:l,offlineDateAddedTimestamp:String(z.toFixed())};K.push(RY)}J=v.next();XL.FT(5);break;case 10:return dR=XL.W,XL.return(dR)}})},qej=function(){var r,l,U,F,Y;
return g.y(function(e){if(e.X==1)return g.T(e,rx(),2);if(e.X!=3)return(r=e.W)?g.T(e,oA(r,"refresh"),3):e.return(!1);l=e.W;if((U=l[0])==null||!U.refreshTime)return e.return(!1);F=Number(l[0].refreshTime);Y=Date.now()/1E3;return e.return(isFinite(F)&&Y>=F)})},up0=function(r,l){var U,F,Y;
return g.y(function(e){switch(e.X){case 1:return g.QB(e,2),g.T(e,Tcf(r,l),4);case 4:return F=e.W,g.T(e,JzY(F),5);case 5:U=PUf(F);g.RR(e,3);break;case 2:Y=g.nP(e),F5("getAndProcessSmartDownloadsResponse request or processing error",Y);case 3:return e.return(U)}})},yzp=function(r,l,U,F){var Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4,$$,Y$,L,Ae,G3,z3,RY,dR;
return g.y(function(XL){switch(XL.X){case 1:return g.T(XL,rx(),2);case 2:Y=XL.W;if(!Y)return XL.return([]);e=[];if((d=F)==null?0:d.length){e=F;XL.FT(3);break}return g.T(XL,oA(Y,"musicPlaylist"),4);case 4:e=XL.W;case 3:if(!e.length)return XL.return([]);K=[];C=Date.now()/1E3;v=g.Q(e);J=v.next();case 5:if(J.done)return K.length?g.T(XL,Nc$(K),10):XL.return([]);m=J.value;P=void 0;M=(A=(P=m)==null?void 0:P.entityMetadata)&&A.nextAutoRefreshIntervalSeconds?Number(A.nextAutoRefreshIntervalSeconds):NaN;E=
Number.isNaN(M)?r:M;n=Z=0;h="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!m.downloadMetadata){XL.FT(8);break}return g.T(XL,kG(Y,m.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:N=XL.W,D=u=void 0,Z=Number((D=(u=N)==null?void 0:u.addedTimestampMillis)!=null?D:"0")/1E3,z=t=void 0,n=Number((z=(t=N)==null?void 0:t.lastModifiedTimestampMillis)!=null?z:"0")/1E3,U4=I=void 0,h=(U4=(I=N)==null?void 0:I.syncState)!=null?U4:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:$$=void 0;if(U||h!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!A||Number(($$=A.lastSyncedTimestampSeconds)!=null?$$:0)+E<=C){Y$=[];L=void 0;if((L=m.tracks)==null?0:L.length)for(Ae=g.Q(m.tracks),G3=Ae.next();!G3.done;G3=Ae.next())z3=G3.value,Y$.push(g.QN(z3).entityId);RY={playlistId:m.playlistId,videoIds:Y$,offlineLastModifiedTimestamp:String(n.toFixed()),autoSync:l,offlineDateAddedTimestamp:String(Z.toFixed())};K.push(RY)}J=v.next();XL.FT(5);break;case 10:return dR=XL.W,XL.return(dR)}})},Tcf=function(r,l){var U,F,Y,e,d,K,C,v,J,m;
return g.y(function(P){switch(P.X){case 1:return U=g.sA(),g.T(P,rx(),2);case 2:F=P.W;if(!F){P.FT(3);break}return g.T(P,uzC(F),4);case 4:Y=P.W;case 3:var A=Y;e={context:g.Qz(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:r},offlineClientState:A,clientStateRequestData:{preferredFormatType:l}}}};d=g.Re(BcG);g.QB(P,5);C={Qt:!0};return g.T(P,g.e5(U,e,d,void 0,C),7);case 7:K=P.W;g.RR(P,6);break;case 5:v=g.nP(P);if(v instanceof g.PA)throw J=
"DPS network manager error for smart downloads: "+v.message,F5(J,v),Error(J);F5("DPS fetch request error for smart downloads",v);throw Error("DPS fetch request error for smart downloads");case 6:m=N4(K);if(K)m!==void 0&&jC(m,"smart downloads");else throw F5("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return P.return(K)}})},ga0=function(r,l){var U,F,Y,e,d,K,C,v;
return g.y(function(J){switch(J.X){case 1:return U=g.sA(),F={context:g.Qz(),videoPlaybackPositionEntities:r,lastSyncTimestampUsec:l},Y=g.Re(H0f),g.QB(J,2),d={Qt:!0},g.T(J,g.e5(U,F,Y,void 0,d),4);case 4:e=J.W;g.RR(J,3);break;case 2:K=g.nP(J);if(K instanceof g.PA)throw C="VPPS network manager error: "+K.message,F5(C,K),Error(C);F5("VPPS fetch request error",K);throw Error("VPPS fetch request error");case 3:v=N4(e);if(e)v!==void 0&&jC(v,"position sync");else throw F5("Network request failed for position sync"),
Error("Network request failed for position sync");return J.return(e)}})},D_Y=function(r,l,U){var F,Y,e,d,K,C,v,J;
return g.y(function(m){switch(m.X){case 1:F=g.sA();var P=U.refreshData,A=U.isEnqueuedForExpiredStreamUrlRefetch,M=U.Il,E=U.offlineSourceData,Z=U.mediaCapabilities,n={entityKey:r};P&&(n.refreshData=P);A&&(n.isExpiredStreamUrlRefetch=A);M&&(n.downloadParameters=M);E&&(n.offlineSourceData=E);P={context:g.PM(l),signatureTimestamp:20244,videos:[n]};Z&&(P.mediaCapabilities=Z);Y=P;e=g.Re(wsf);g.QB(m,2);K={Qt:!0};return g.T(m,g.e5(F,Y,e,void 0,K),4);case 4:d=m.W;g.RR(m,3);break;case 2:C=g.nP(m);if(C instanceof
g.PA)throw v="GetPDE network manager error: "+C.message,F5(v,C),Error(v);F5("GetPDE fetch request error",C);throw Error("GetPDE fetch request error");case 3:J=N4(d);if(d)J!==void 0&&jC(J,"PDE");else throw F5("Network request failed for PDE"),Error("Network request failed for PDE");return m.return(d)}})},N4=function(r){var l;
return(l=r.errorMetadata)==null?void 0:l.status},jC=function(r,l){l=l?" for "+l:"";
if(r===0)throw r="Empty response body"+l,F5(r),Error(r);r="Response with error"+l;F5(r);throw Error(r);},Nc$=function(r){var l,U,F,Y,e,d,K,C;
return g.y(function(v){switch(v.X){case 1:return l=g.sA(),U=ixR(r),F=g.Re(V6R),g.QB(v,2),e={Qt:!0},g.T(v,g.e5(l,U,F,void 0,e),4);case 4:Y=v.W;g.RR(v,3);break;case 2:d=g.nP(v);if(d instanceof g.PA)throw K="offlinePlaylistSyncCheck network manager error: "+d.message,F5(K,d),Error(K);F5("offlinePlaylistSyncCheck fetch request error",d);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:C=N4(Y);if(!Y)throw F5("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(C!==void 0)jC(C,"playlist sync");else if(!Y.offlinePlaylistSyncCheckDatas||!Y.offlinePlaylistSyncCheckDatas.length)throw F5("No data for playlist sync"),Error("No data for playlist sync");return v.return(Y.offlinePlaylistSyncCheckDatas.map(function(J){return J.offlinePlaylistSyncCheckData}))}})},q4=function(r){this.W=r},fFj=function(r,l){var U,F,Y,e,d,K;
return g.y(function(C){switch(C.X){case 1:U=new Map,F=g.Q(l),Y=F.next();case 2:if(Y.done){C.FT(4);break}e=Y.value;d=U;K=d.set;return g.T(C,r.X(e),5);case 5:K.call(d,e,C.W);Y=F.next();C.FT(2);break;case 4:return C.return(U)}})},TX=function(r,l,U,F,Y,e){l=g.Ea(l,U);
F=Object.assign({},e,{priority:F,retryScheduleIntervalsInSeconds:Y});return{actionType:r,entityKey:l,actionMetadata:F}},u6=function(r,l,U,F,Y,e){this.status=r;
this.W=l;this.K=U;this.X=F;this.L=Y;this.downloadState=e},SeG=function(r,l,U){this.W=r;
this.WQ=l;this.L=U},t6Y=function(r,l){var U,F,Y,e,d,K,C,v,J;
return g.y(function(m){switch(m.X){case 1:return U=l.entityKey,Y=(F=g.V(l.actionMetadata,yR))==null?void 0:F.isEnqueuedForExpiredStreamUrlRefetch,g.QB(m,2),e=void 0,g.T(m,ztC(r,l),4);case 4:e=m.W;g.QB(m,5);var P=(P=g.V(l.actionMetadata,yR))?{maximumDownloadQuality:P.maximumDownloadQuality}:void 0;return g.T(m,D_Y(U,r.WQ,{isEnqueuedForExpiredStreamUrlRefetch:Y,Il:P,offlineSourceData:e}),7);case 7:d=m.W;g.RR(m,6,2);break;case 5:return g.nP(m,2),K=Cq(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",F5("PDE handleAdd error"),m.return(BR(l,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",K,"DOWNLOAD_STATE_FAILED"));case 6:return g.T(m,psR(r,d,l),8);case 8:return m.return(BR(l,!0,d.orchestrationActions));case 2:return C=g.nP(m),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.np&&C.type==="QUOTA_EXCEEDED"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),F5("PDE handleAdd error"),m.return(BR(l,!1,void 0,v,J,"DOWNLOAD_STATE_FAILED"))}})},aFp=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4;
return g.y(function($$){switch($$.X){case 1:return U=l.entityKey,F=g.QN(U).entityId,g.T($$,as(r.W,{mode:"readonly",ag:!0},function(Y$){var L=f_(Y$,U,"playbackData"),Ae=f_(Y$,g.Ea(F,"offlineVideoPolicy"),"offlineVideoPolicy");Y$=f_(Y$,g.Ea(F,"transfer"),"transfer");return g.qZ.all([L,Ae,Y$])}),2);
case 2:Y=$$.W;e=g.Q(Y);d=e.next().value;K=e.next().value;C=e.next().value;v=d;J=K;m=C;if(!v||!J)return $$.return(BR(l,!0));P=[];E=((M=v)==null?0:M.playerResponseJson)?JSON.parse(v.playerResponseJson):null;if(!(m&&E&&r.WQ.Y("html5_refresh_deprecated_downloads"))){$$.FT(3);break}A=LQ0(r,E,m);return g.T($$,czC(r,m),4);case 4:P=$$.W;case 3:Z={lastPlayerResponseTimestampSeconds:v.playerResponseTimestamp,offlineToken:J.offlineToken,formatIds:P};n={};if((h=m)==null?0:h.maximumDownloadQuality)n.maximumDownloadQuality=
m.maximumDownloadQuality;g.QB($$,5);N=void 0;return g.T($$,ztC(r,l),7);case 7:return N=$$.W,g.QB($$,8),g.T($$,D_Y(U,r.WQ,{refreshData:Z,Il:n,offlineSourceData:N,mediaCapabilities:A}),10);case 10:u=$$.W;g.RR($$,9,5);break;case 8:return g.nP($$,5),D=Cq(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",F5("PDE handleRefresh error"),$$.return(BR(l,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",D,
"DOWNLOAD_STATE_FAILED"));case 9:return g.T($$,psR(r,u,l),11);case 11:return $$.return(BR(l,!0,u.orchestrationActions));case 5:return t=g.nP($$),z="PDE handleRefresh error",t instanceof Error&&(z="PDE handleRefresh error: "+t.message),I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U4="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.np&&t.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",U4="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
F5(z),$$.return(BR(l,!1,void 0,I,U4,"DOWNLOAD_STATE_FAILED"))}})},ztC=function(r,l){var U,F,Y,e;
return g.y(function(d){if(d.X==1)return U=g.QN(l.entityKey).entityId,F=g.Ea(U,"videoDownloadContextEntity"),g.T(d,kG(r.W,F,"videoDownloadContextEntity"),2);Y=d.W;return(e=Y)!=null&&e.offlineModeType?d.return({offlineModeType:Y.offlineModeType}):d.return(void 0)})},psR=function(r,l,U){var F,Y,e,d,K;
return g.y(function(C){if(C.X==1){if(!l.frameworkUpdates||!g.V(l.frameworkUpdates,ho))return C.return();if(!(g.V(l.frameworkUpdates,ho).mutations&&g.V(l.frameworkUpdates,ho).mutations.length>0&&g.V(l.frameworkUpdates,ho).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return C.FT(2);F=g.QN(g.V(l.frameworkUpdates,ho).mutations[0].entityKey).entityId;return g.T(C,nq(r.W,F),3)}if(C.X!=2){Y=C.W;e=g.V(U.actionMetadata,yR);if(K=(d=e)==null?void 0:d.playlistId)Y.playlistId=K;Y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Oi(r.WQ)?g.T(C,RA(F,r.W,U,r.L,Y),2):g.aL(r.WQ)?g.T(C,GX(F,r.W,U,r.L),2):C.FT(2)}return g.T(C,x8C(g.V(l.frameworkUpdates,ho)),0)})},BR=function(r,l,U,F,Y,e){return new u6(l?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Cq(r),U,F,Y,e)},LQ0=function(r,l,U){l=U_C(r.WQ,U.cotn,l);
U=g.WZ(l);return g.kKz(l,U,r.WQ)},czC=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P;
return g.y(function(A){if(A.X==1)return U=[],g.T(A,as(r.W,{mode:"readonly",ag:!0},function(M){var E=[],Z=l.offlineVideoStreams;if(Z){Z=g.Q(Z);for(var n=Z.next();!n.done;n=Z.next())E.push(f_(M,n.value,"offlineVideoStreams"))}return g.qZ.all(E)}),2);
if(F=A.W)for(Y=g.Q(F),e=Y.next();!e.done;e=Y.next())if(d=e.value,K=void 0,(K=d)==null?0:K.streamsProgress)for(C=d.streamsProgress,v=0;v<C.length;v++)J=C[v],m=JSON.parse(J.formatStreamBytes),P={itag:m.itag,lmt:m.lastModified,xtags:m.xtags},U.push(P);return A.return(U)})},IFY=function(r,l){this.W=r;
this.WQ=l},kd8=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A;
return g.y(function(M){switch(M.X){case 1:return U=Cq(l),g.T(M,oA(r.W,"videoPlaybackPositionEntity"),2);case 2:F=M.W;if(F.length===0)return M.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));g.QB(M,3);return g.T(M,wt.getInstance(),5);case 5:Y=M.W;if(!Y)throw Error("prefStorage is undefined");return g.T(M,Y.get("psi"),6);case 6:return e=M.W,C=(K=(d=e)==null?void 0:d.R5)!=null?K:"0",g.T(M,ga0(F,C),7);case 7:return v=M.W,J={isPaused:v.watchHistoryPaused,R5:v.syncTimestampUsec},g.T(M,Y.set("psi",
J),8);case 8:if(J.isPaused){M.FT(9);break}m=g.V(v.frameworkUpdates,ho);if(!v.frameworkUpdates||!m){M.FT(9);break}return g.T(M,x8C(m),9);case 9:g.RR(M,4);break;case 3:return P=g.nP(M),A="PPE handleRefresh error: "+(P instanceof Error?P.message:"unknown error"),F5(A),M.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return M.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
U))}})},rbj=function(r,l){var U,F,Y,e,d,K,C,v;
return g.y(function(J){switch(J.X){case 1:return U=Cq(l),F=g.QN(l.entityKey).entityId,g.QB(J,2),g.T(J,wt.getInstance(),4);case 4:Y=J.W;if(!Y)throw Error("prefStorage is undefined");return g.T(J,Y.get("psi"),5);case 5:e=J.W;d=g.V(l.actionMetadata,olY);if(((K=e)==null?void 0:K.isPaused)!==!1||(C=d)==null||!C.lastPlaybackPositionSeconds){J.FT(6);break}v={key:g.Ea(F,"videoPlaybackPositionEntity"),videoId:F,lastPlaybackPositionSeconds:d.lastPlaybackPositionSeconds};return g.T(J,Is(r.W,v,"videoPlaybackPositionEntity"),
6);case 6:g.RR(J,3);break;case 2:return g.nP(J),J.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U))}})},$0p=function(r,l){var U,F,Y;
return g.y(function(e){switch(e.X){case 1:U=Cq(l);g.QB(e,2);F=g.QN(l.entityKey).entityId;if(F==="!*$_ALL_ENTITIES_!*$")return g.T(e,m8r(r.W),5);Y=g.Ea(F,"videoPlaybackPositionEntity");return g.T(e,JKC(r.W,Y),5);case 5:g.RR(e,3);break;case 2:return g.nP(e),e.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
U))}})},lsr=function(r,l){this.api=r;
this.W=l;this.logger=new g.AV("woffle");this.X=!1;this.wv={Gh:this.Gh};this.logger.debug("Initialized OfflineMediaManager")},U0b=function(r){return g.y(function(l){return l.return(nt0(r))})},FJY=function(r){var l;
return g.y(function(U){if(U.X==1)return g.T(U,g.XwS(r),2);l=U.W;return U.return(l.filter(function(F){return!!F.url}).map(function(F){return F.url}))})},HR=function(r,l){var U=g.VL(l);
if(U===1||U===0)return Promise.resolve();(U=YSp(r,l))&&U.stopVideo();r.L=0;return U0b(l)},gx=function(r,l,U,F){U=U===void 0?!1:U;
F=F===void 0?!0:F;var Y=typeof l==="string"?l:l.videoDetails.videoId;g.VL(Y)===2&&((l=YSp(r,Y))?l.stopVideo():r.logger.info(function(){return"Corresponding player for "+Y+" not found. Pausing anyway"}),g.ff(Y,2),r.L=2,U?eir(r.W):F&&d0p(r.W))},YSp=function(r,l){var U;
return((U=r.player)==null?void 0:U.getVideoData().videoId)===l?r.player:null},OJ0=function(r,l,U){l.getPlayerResponse();
g.ff(l.videoId,2);r.L=2;r.X=!1;var F;(F=r.player)==null||F.dispose();r.player=r.api.f5(l);l={};r.player.yp((l.localmediachange=r.NA,l.signatureexpired=r.gH,l.statechange=r.Vcz,l),r);var Y=r.Gh(U);r.player.tL(g.EZ(Y,Y,!0,"m"),!1);r.logger.debug(function(){return"Starting headless playback with quality: "+Y});
r.player.SM(!1)},KJC=function(r,l){this.W=r;
this.WQ=l},vlR=function(r,l){var U,F;
return g.y(function(Y){switch(Y.X){case 1:return U=Cq(l),g.T(Y,kG(r.W,l.entityKey,"transfer"),2);case 2:if(F=Y.W)return Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));g.QB(Y,3);return g.T(Y,CuY(r,l),5);case 5:g.RR(Y,4);break;case 3:return g.nP(Y),Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
U))}})},JbC=function(r,l){var U,F;
return g.y(function(Y){switch(Y.X){case 1:return U=Cq(l),g.T(Y,kG(r.W,l.entityKey,"transfer"),2);case 2:F=Y.W;if(!F||F.transferState!=="TRANSFER_STATE_COMPLETE")return Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));g.QB(Y,3);return g.T(Y,CuY(r,l,!0),5);case 5:g.RR(Y,4);break;case 3:return g.nP(Y),Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U))}})},m0$=function(r,l){var U,F,Y,e,d,K,C,v,J,m;
return g.y(function(P){switch(P.X){case 1:return U=Cq(l),F=g.QN(l.entityKey).entityId,g.T(P,as(r.W,{mode:"readonly",ag:!0},function(A){var M=f_(A,l.entityKey,"transfer");A=f_(A,g.Ea(F,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.qZ.all([M,A])}),2);
case 2:Y=P.W;e=g.Q(Y);d=e.next().value;K=e.next().value;C=d;v=K;if(!C||C.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return P.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));g.QB(P,3);C.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.T(P,Is(r.W,C,"transfer"),5);case 5:J=g.QN(C.key).entityId;Ia0({videoId:J,cj:C,offlineModeType:(m=v)==null?void 0:m.offlineModeType});g.RR(P,4);break;case 3:return g.nP(P),P.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
U,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return P.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U))}})},CuY=function(r,l,U){U=U===void 0?!1:U;
var F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n;return g.y(function(h){switch(h.X){case 1:return F=g.V(l.actionMetadata,PuY),Y=g.QN(l.entityKey).entityId,e=g.Ea(Y,"downloadStatusEntity"),g.T(h,as(r.W,{mode:"readonly",ag:!0},function(N){var u=f_(N,e,"downloadStatusEntity");N=f_(N,g.Ea(Y,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.qZ.all([u,N])}),2);
case 2:return d=h.W,K=g.Q(d),C=K.next().value,v=K.next().value,J=C,m=v,P="TRANSFER_STATE_TRANSFER_IN_QUEUE",((A=J)==null?void 0:A.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(P="TRANSFER_STATE_PAUSED_BY_USER"),Z={key:l.entityKey,transferState:P,cotn:g.qt(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(M=F)==null?void 0:M.maximumDownloadQuality,preferredAudioTrack:(E=F)==null?void 0:E.preferredAudioTrack,transferRetryCount:0,isRefresh:U,hasLoggedFirstStarted:!1},g.T(h,as(r.W,
{mode:"readwrite",ag:!0},function(N){var u=[];U&&u.push(tr(N,g.Ea(Y,"offlineVideoStreams")));u.push(p_(N,Z,"transfer"));return g.qZ.all(u)}),3);
case 3:if(!U){h.FT(4);break}return g.T(h,U0b(Y),4);case 4:cK$({videoId:Y,cj:Z,offlineModeType:(n=m)==null?void 0:n.offlineModeType}),g.Wm(h)}})},Mb8=function(r,l,U,F){if(!r.action.entityKey)throw Error("entityKey is missing.");
var Y=g.QN(r.action.entityKey);Y={entityType:Y.Vl,entityId:Y.entityId,offlineOrchestrationActionType:r.action.actionType,orchestrationAction:{orchestrationActionId:r.actionId}};l&&(Y.offlineOrchestrationActionResult=l.status,Y.isRetryable=U?!1:l.W,l.L&&(Y.offlineOrchestrationFailureReason=Ab8(l.L,Y.isRetryable)));var e,d;if((e=r.action.actionMetadata)==null?0:(d=e.offlineLoggingData)==null?0:d.offlineModeType)Y.offlineModeType=r.action.actionMetadata.offlineLoggingData.offlineModeType;F&&(Y.additionalOrchestrationActions=
F.map(function(K){return{orchestrationActionId:K.actionId}}));
return Y},Ab8=function(r,l){return r!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||l?r==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&l?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":r:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},shb=function(r,l){var U={offlineOrchestrationContext:Mb8(r)};
l=q2Y(l,U);THG(j7C(),l,r.rootActionId)},x0Y=function(r,l,U,F){F=F===void 0?[]:F;
l={offlineOrchestrationContext:Mb8(r,l,U,F)};l=q2Y(3,l);THG(j7C(),l,r.rootActionId)},WJ8=function(){this.actions=[]},QhY=function(r,l){l=g.Q(l);
for(var U=l.next();!U.done;U=l.next())U=U.value,shb(U,1),r.actions.push(U);r.actions.sort(r.W)},Elf=function(r,l){if(l)for(var U=0;U<r.actions.length;U++)if(l==="!*$_ALL_ENTITIES_!*$"&&r.actions[U].actionId!==l||l!=="!*$_ALL_ENTITIES_!*$"&&r.actions[U].rootActionId===l&&r.actions[U].actionId!==l)r.actions.splice(U,1),U--},ZJj=function(r,l){r=g.Q(r.actions);
for(var U=r.next();!U.done;U=r.next())if(U.value.actionId===l)return!0;return!1},wx=function(r,l,U,F,Y){g.H.call(this);
var e=this;this.X=r;this.KP=l;this.kN=U;this.j=F;this.WQ=Y;this.W=new WJ8;this.D=new g.lt;this.L=new g.F1(function(){e.retry()});
this.T=NaN;this.U=!1;this.wv={gVT:function(){return e.W},
D3:function(){return e.D},
k4N:function(){return e.L},
retry:function(){return e.retry()}};
g.w(this,this.L);this.V=this.X.observe(this.sF.bind(this))},nlG=function(r,l,U,F,Y){var e;
return g.y(function(d){if(d.X==1)return e=new wx(r,l,U,F,Y),g.T(d,Ri8(e),2);hiR(e);return d.return(e)})},hiR=function(r){var l=r.W.actions[0];
return r.K?((l==null?void 0:l.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&r.K[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(r.U=!0),Promise.resolve()):GE0(r)},GE0=function(r){var l,U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n;
return g.y(function(h){switch(h.X){case 1:if(r.K)throw Error("Already processing an action");if(r.QT())return h.return();l=r.W.actions.shift();t18(r.kN,!l);if(l===void 0)return h.return();l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&l.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&Elf(r.W,l.actionId);U="";l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&l.rootActionId===l.actionId&&(U=l.actionId);F=[l];r.K=F;if(Y=r.KP[l.entityType]){h.FT(2);break}r.K=
void 0;return g.T(h,GE0(r),3);case 3:return h.return();case 2:e=g.Q(F);for(d=e.next();!d.done;d=e.next())K=d.value,shb(K,2);g.QB(h,4,5);return g.T(h,fFj(Y,F.map(function(N){return N.action})),7);
case 7:C=h.W,v=g.Q(F),J=v.next();case 8:if(J.done){h.FT(10);break}m=J.value;P=C.get(m.action);return g.T(h,XlY(r,m,P),9);case 9:J=v.next();h.FT(8);break;case 10:Elf(r.W,U);case 5:g.iz(h);r.K=void 0;g.Nf(h,6);break;case 4:return A=g.nP(h),F5("Orchestration error",A),g.QB(h,12),g.T(h,iJY(r,F),14);case 14:g.RR(h,5);break;case 12:M=g.nP(h);F5("Orchestration retry error",M);E=g.Q(F);for(Z=E.next();!Z.done;Z=E.next())n=Z.value,n.retryScheduleIndex<3&&QhY(r.W,[n]);h.FT(5);break;case 6:return g.T(h,GE0(r),
0)}})},XlY=function(r,l,U){var F,Y,e,d,K,C,v,J,m,P,A,M;
return g.y(function(E){switch(E.X){case 1:F=l.retryScheduleIndex+2===3;if(U.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){E.FT(2);break}if(U.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){E.FT(0);break}x0Y(l,U,F);if(U.W&&l.retryScheduleIndex+1<3)return g.T(E,iJY(r,[l]),0);e=((Y=U)==null?0:Y.X)?U.X:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";d={entityKey:l.action.entityKey,failureReason:e};K=void 0;g.Oi(r.WQ)?K="mainVideoDownloadStateEntity":g.aL(r.WQ)&&(K="musicTrackDownloadMetadataEntity");
if(!K||!U.downloadState){E.FT(7);break}C=g.QN(l.action.entityKey).entityId;return g.T(E,PR(C,K,r.X,U.downloadState),7);case 7:eC(r.j,d);if(U.downloadState==="DOWNLOAD_STATE_FAILED"&&r.WQ.Y("html5_auto_retry_failed_pde_actions")){E.FT(0);break}F5("Orchestration result is not retryable, deleting action");return g.T(E,JKC(r.X,QR(l).key),0);case 2:v=void 0;try{v=(J=U.K)==null?void 0:J.map(function(Z){return r.createAction(Z,l)})}catch(Z){return x0Y(l,U,F),m={entityKey:l.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},eC(r.j,m),F5("Orchestration subactions creation error",Z),E.return()}x0Y(l,U,F,v);if(!v){E.FT(12);break}P=v.map(function(Z){return QR(Z)});
A=0;case 13:if(!(A<v.length)||r.U){E.FT(15);break}return g.T(E,as(r.X,{mode:"readwrite",ag:!0},function(Z){var n=[];n.push(la8(Z,P.slice(A,A+10),"offlineOrchestrationActionWrapperEntity"));return g.qZ.all(n)}),16);
case 16:A+=10;E.FT(13);break;case 15:if(r.U)return r.U=!1,E.return();case 12:return M=QR(l),g.T(E,JKC(r.X,M.key),17);case 17:shb(l,4),g.Wm(E)}})},qSY=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A;
return g.y(function(M){U=[];F=Infinity;Y=4E3;e=g.Q(l);for(d=e.next();!d.done;d=e.next())K=d.value,C=Number(K.enqueueTimeSec),v=bJC(C),J=K.retryScheduleIndex,m=J!=null&&J>0,v>0&&m?(F=Math.min(F,C),Y=Math.min(v,Y)):U.push(K);isFinite(F)&&(!r.L.isActive()||F<r.T)&&(r.T=F,r.L.start(Y));r.D.i6()||(P=U.length,U=U.filter(function(E){var Z;E=((Z=E.actionProto)==null?void 0:Z.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!NQf.includes(E)}),A=U.length<P,!r.L.isActive()&&A&&r.L.start(1));
U.length>0&&jh$(r,U);return g.T(M,hiR(r),0)})},u1R=function(r){var l,U,F,Y,e,d,K;
return g.y(function(C){if(C.X==1)return g.T(C,TQ$(r),2);l=C.W;U=[];F=g.Q(l);for(Y=F.next();!Y.done;Y=F.next())e=Y.value,d=g.QN(e.key),K=d.entityId,ZJj(r.W,K)||U.push(e);return g.T(C,qSY(r,U),0)})},bJC=function(r){r=r*1E3-Date.now();
return r>4E3?4E3:r},iJY=function(r,l){var U,F,Y;
return g.y(function(e){U=g.Q(l);for(F=U.next();!F.done;F=U.next()){Y=F.value;var d=void 0,K=void 0,C=((K=Y.action)==null?void 0:(d=K.actionMetadata)==null?void 0:d.retryScheduleIntervalsInSeconds)||[1,2,4];d=1;Y.retryScheduleIndex<C.length&&(d=C[Y.retryScheduleIndex]);Y.W=d*1E3+Date.now();Y.retryScheduleIndex++}return g.T(e,ybY(r,l),0)})},Ri8=function(r){var l;
return g.y(function(U){if(U.X==1)return g.T(U,oA(r.X,"offlineOrchestrationActionWrapperEntity"),2);l=U.W;return g.T(U,qSY(r,l),0)})},jh$=function(r,l){l.length!==0&&l.forEach(function(U){U=WR(U);
U.retryScheduleIndex<3&&QhY(r.W,[U])})},TQ$=function(r,l){var U;
return g.y(function(F){if(F.X==1)return g.T(F,oA(r.X,"offlineOrchestrationActionWrapperEntity",l),2);U=F.W;return F.return(U.filter(Wub))})},ybY=function(r,l){if(l.length===0)return Promise.resolve([]);
l=l.map(function(U){return QR(U)});
return vtY(r.X,l)},BQY=function(r){this.jc=r;
this.W=void 0},HJb=function(r,l){var U,F,Y,e;
return g.y(function(d){U=l.videoId;F=!0;if(l.captionTracks.length)Y=ah0(l),r.W=new g.Gi(r.jc,l,Y);else if(l.Wl)e=g.BhL(l),r.W=new g.id(r.jc,l.Wl,U,e,l.Pq,l.eventId),F=l.Pq;else return d.return();return d.return(new Promise(function(K){var C;(C=r.W)==null||C.XO({by:function(){return g.y(function(v){if(v.X==1)return g.T(v,r.by(U,F),2);K();g.Wm(v)})},
A7:function(){}})}))})},glq=function(r){var l;
return g.y(function(U){if(U.X==1)return g.T(U,h70(r),2);l=U.W;return U.return(!!l&&l.length>0)})},Dp=function(r){g.H.call(this);
this.W=r;this.X=this.W.observe(this.L.bind(this))},wl$=function(r,l){var U,F,Y,e,d,K,C;
return g.y(function(v){switch(v.X){case 1:if(l.length===0)return v.return([]);U=l.map(function(J){return g.Ea(J,"transfer")});
return g.T(v,oA(r.W,"transfer",U),2);case 2:F=v.W;Y=F.filter(Wub).map(function(J){return g.QN(J.key).entityId});
e=l.filter(function(J){return Y.indexOf(J)===-1});
if(e.length===0)return v.return([]);d=g.Q(e);K=d.next();case 3:if(K.done){v.FT(5);break}C=K.value;return g.T(v,U0b(C),4);case 4:K=d.next();v.FT(3);break;case 5:return v.return(e)}})},fsY=function(r,l,U,F,Y,e){var d,K,C;
return g.y(function(v){d="STREAM_TYPE_UNKNOWN";U.video&&U.audio?(d="STREAM_TYPE_AUDIO_AND_VIDEO",F5("unexpected stream type")):U.video&&!U.audio?d="STREAM_TYPE_VIDEO":!U.video&&U.audio&&(d="STREAM_TYPE_AUDIO");K=g.Ea(l,"offlineVideoStreams");C={numBytesDownloaded:Y.toFixed(),numTotalBytes:e.toFixed(),streamType:d,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(F),itag:d==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(U.itag):void 0};return g.T(v,as(r,{mode:"readwrite",ag:!0},
function(J){var m=f_(J,K,"offlineVideoStreams"),P=f_(J,g.Ea(l,"transfer"),"transfer");return g.qZ.all([m,P]).then(function(A){A=g.Q(A);var M=A.next().value;A=A.next().value;if(!A)return tr(J,K).then(function(){});
var E=D0R(M);M=Vbq(M,F,C,K);var Z=p_(J,M,"offlineVideoStreams");D0R(M)>E&&(A.lastProgressTimeMs=Date.now().toString());E=[Z];A.offlineVideoStreams||(A.offlineVideoStreams=[]);A.offlineVideoStreams.indexOf(K)===-1&&(A.offlineVideoStreams.push(K),E.push(p_(J,A,"transfer")));return g.qZ.all(E)})}),0)})},SSq=function(r,l){var U,F,Y,e,d;
return g.y(function(K){if(K.X==1)return U=g.Ea(l,"offlineVideoStreams"),g.T(K,kG(r,U,"offlineVideoStreams"),2);F=K.W;if(!F||!F.streamsProgress)return K.return();Y=g.Q(F.streamsProgress);for(e=Y.next();!e.done;e=Y.next())d=e.value,d.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",d.numTotalBytes!==d.numBytesDownloaded&&(d.numBytesDownloaded=d.numTotalBytes);return g.T(K,Is(r,F,"offlineVideoStreams"),0)})},Vbq=function(r,l,U,F){if(r&&r.streamsProgress){F=r;
a:{l=l.itag+";"+l.xtags;for(var Y=r.streamsProgress,e=0;e<Y.length;e++){var d=JSON.parse(Y[e].formatStreamBytes);if(d.itag+";"+d.xtags===l){Y[e]=U;U=Y;break a}}Y.push(U);U=Y}F.streamsProgress=U}else r={key:F,streamsProgress:[U]};return r},D0R=function(r){if(r==null?0:r.streamsProgress){var l=0;
r=r.streamsProgress;for(var U=0;U<r.length;U++){var F=r[U];isNaN(Number(F.numBytesDownloaded))?F5("stream progress bytes number invalid"):l+=Number(F.numBytesDownloaded)}return l}return 0},ziY=function(r,l,U,F){g.H.call(this);
var Y=this;this.X=r;this.api=l;this.vQ=U;this.sF=F;this.D=new g.lt;this.K=new g.F1(function(){Y.W&&Y.W.transferState==="TRANSFER_STATE_TRANSFERRING"&&Y.D.i6()&&((Y.W.transferRetryCount||0)<3?gx(Y.j,Y.U,!1,!1):HR(Y.j,Y.U.videoDetails.videoId),Y.SO("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.kN=this.qh=0;this.V=this.T=!1;this.yT=g.GQ(this.api.N().experiments,"html5_transfer_processing_logs_interval");this.OF=new g.Lg(this);this.wv={FvG:function(){return Y.K},
NwT:function(){return Y.sF},
D3:function(){return Y.D}};
this.KP=this.X.observe(this.FX.bind(this));this.j=new lsr(l,this);this.Nh=new BQY(l);this.rz=new Dp(this.X);this.iG=this.D.listen("publicytnetworkstatus-online",this.Mm.bind(this));this.YN=this.D.listen("publicytnetworkstatus-offline",this.acf.bind(this));this.V=this.api.N().Y("html5_less_transfer_processing_logs");g.w(this,this.OF);this.OF.G(l,"offlinetransferpause",this.OJN);g.Oi(this.api.N())?this.L="mainVideoDownloadStateEntity":g.aL(this.api.N())&&(this.L="musicTrackDownloadMetadataEntity")},
plj=function(r){return g.y(function(l){if(l.X==1)l=g.T(l,ZxC(),2);
else{var U=r.rz;var F=g.D$();F=Object.keys(F);U=wl$(U,F);l=g.T(l,U,0)}return l})},fq=function(r,l){l=l===void 0?!1:l;
var U;return g.y(function(F){if(F.X==1){if(r.W)throw Error("Already downloading a video");r.kN=0;r.T=!1;return g.T(F,tbb(r),2)}return F.X!=4?(U=F.W,LuG(r.vQ,!U),U&&r.D.i6()?l?g.T(F,new Promise(function(Y){g.Rp(Y,1E3)}),4):F.FT(4):(!U&&r.W&&VR(r),F.FT(0))):g.T(F,LJ$(r,U),0)})},cbb=function(r){return g.y(function(l){if(l.X==1)return r.U?g.T(l,HR(r.j,r.U.videoDetails.videoId),3):l.FT(0);
VR(r);g.Wm(l)})},asb=function(r,l){var U,F,Y;
return g.y(function(e){switch(e.X){case 1:return g.QB(e,2),(U=!!l.captionTracks.length||!!l.Wl)?g.T(e,glq(l.videoId),4):e.return();case 4:return(F=e.W)?e.return():g.T(e,HJb(r.Nh,l),5);case 5:g.RR(e,0);break;case 2:Y=g.nP(e),F5("Caption downloading error",Y,l.cotn),g.Wm(e)}})},LJ$=function(r,l){var U,F,Y,e,d,K;
return g.y(function(C){switch(C.X){case 1:if(r.T)return C.return();r.T=!0;r.W=l;U=g.QN(r.W.key);F=U.entityId;Y=void 0;if(r.W.transferState==="TRANSFER_STATE_TRANSFERRING")return g.T(C,SC(r,F),7);if(r.W.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||r.W.transferRetryCount||r.W.hasLoggedFirstStarted){C.FT(3);break}return g.T(C,SC(r,F),5);case 5:return Y=C.W,r.W.hasLoggedFirstStarted=!0,g.T(C,IsR(r),6);case 6:aaC({videoId:F,cj:r.W,offlineModeType:Y},void 0,void 0,!0);C.FT(3);break;case 7:Y=C.W,
Kq({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:F,cj:r.W,offlineModeType:Y});case 3:return g.T(C,kEf(r),8);case 8:return e=null,g.QB(C,9),g.T(C,oKj(r,l),11);case 11:e=C.W;r.U=e;g.RR(C,10);break;case 9:return d=g.nP(C),F5("error getting player response",d,l.cotn),g.T(C,r.SO("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return C.return();case 10:return K=U_C(r.api.N(),l.cotn,e),g.T(C,asb(r,K),13);case 13:return g.T(C,FJY(K.videoId),
14);case 14:K.zD=C.W,OJ0(r.j,K,l.maximumDownloadQuality),r.K.start(108E5),g.Wm(C)}})},tbb=function(r){var l,U;
return g.y(function(F){if(F.X==1)return g.T(F,oA(r.X,"transfer"),2);l=F.W;U=l.filter(rTC).sort($hq);return U.length===0?F.return():F.return(U[0])})},kEf=function(r){var l,U,F;
return g.y(function(Y){if(Y.X==1){if(!r.W)return zX(r,"onTransferStart"),Y.return();r.K.start(108E5);return g.T(Y,pq(r,"TRANSFER_STATE_TRANSFERRING"),2)}l=r.W;return(F=((U=l)==null?0:U.key)?g.QN(l.key).entityId:"")&&r.L?g.T(Y,PR(F,r.L,r.X,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):Y.FT(0)})},eir=function(r){var l,U,F,Y;
g.y(function(e){switch(e.X){case 1:if(!r.W){zX(r,"onTransferPausedByUser");e.FT(2);break}l=r.W;r.K.stop();return g.T(e,pq(r,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:F=((U=l)==null?0:U.key)?g.QN(l.key).entityId:"";if(!F||!r.L){e.FT(4);break}return g.T(e,PR(F,r.L,r.X,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.T(e,SC(r,F),6);case 6:Y=e.W,kVq({videoId:F,cj:l,offlineModeType:Y});case 2:VR(r),fq(r),g.Wm(e)}})},d0p=function(r){var l,U,F;
g.y(function(Y){if(Y.X==1){if(!r.W)return zX(r,"onTransferPausedByNetwork"),Y.return();r.K.stop();return g.T(Y,pq(r,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(Y.X!=3)return l=r.W,(F=((U=l)==null?0:U.key)?g.QN(l.key).entityId:"")&&r.L?g.T(Y,PR(F,r.L,r.X,"DOWNLOAD_STATE_PAUSED"),3):Y.FT(3);VR(r);g.Wm(Y)})},ly0=function(r){var l,U,F,Y,e;
g.y(function(d){switch(d.X){case 1:if(!r.W)return zX(r,"onTransferComplete"),d.return();l=r.W;r.K.stop();if(!l||!r.U){d.FT(2);break}U=U_C(r.api.N(),l.cotn,r.U);return g.T(d,asb(r,U),2);case 2:return g.T(d,pq(r,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:Y=((F=l)==null?0:F.key)?g.QN(l.key).entityId:"";if(!Y||!r.L){d.FT(5);break}return g.T(d,PR(Y,r.L,r.X,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.T(d,SSq(r.X,Y),7);case 7:return g.T(d,SC(r,Y),8);case 8:e=d.W,Kq({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:Y,cj:l,offlineModeType:e}),VR(r),fq(r),g.Wm(d)}})},UhC=function(r,l,U){var F,Y;
g.y(function(e){switch(e.X){case 1:if(!r.W)return zX(r,"onTransferProgress: "+l),e.return();if(r.W.transferState==="TRANSFER_STATE_TRANSFERRING"){e.FT(2);break}return g.T(e,kEf(r),2);case 2:F=Date.now();if(!(F-r.qh>1E3)){e.FT(4);break}r.qh=F;return g.T(e,fsY(r.X,U.videoId,U.X,U.iR,U.bytesDownloaded,U.W),5);case 5:if(r.V&&!(r.V&&F-r.kN>r.yT)){e.FT(4);break}r.kN=F;return g.T(e,SC(r,l),7);case 7:Y=e.W,aaC({videoId:l,cj:r.W,offlineModeType:Y},U.bytesDownloaded,U.W);case 4:r.K.start(108E5),g.Wm(e)}})},
FZG=function(r){var l=(r.W.transferRetryCount||0)<3;
l&&(r=r.W,r.transferRetryCount=(r.transferRetryCount||0)+1);return l},YWY=function(r,l){l=l===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":l;
var U,F,Y,e;return g.y(function(d){if(d.X==1)return r.W||zX(r,"setTransferToFailed: "+l),U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l==="TRANSFER_FAILURE_REASON_NETWORK"?U="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":l==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.T(d,pq(r,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",l),2);if(d.X!=3)return eC(r.sF,{entityKey:(F=r.W)==null?void 0:F.key,failureReason:U}),
Y=r.W?g.QN(r.W.key).entityId:"",g.T(d,SC(r,Y),3);e=d.W;var K={videoId:Y,cj:r.W,offlineModeType:e},C=l,v={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};C&&(v.transferFailureReason=C,v.failureReason=oar(C));Kq(v,K);g.Wm(d)})},pq=function(r,l,U,F){var Y;
return g.y(function(e){if(e.X==1){if(!r.W)return zX(r,"saveTransferState: "+l),e.return();r.W.transferState=l;r.W.failureReason=F;g.QB(e,2);return g.T(e,IsR(r,function(d){return U?SO(d,"offlineVideoStreams",r.W.offlineVideoStreams).then(function(K){for(var C=g.Q(K),v=C.next();!v.done;v=C.next())if((v=v.value)&&v.streamsProgress){v=g.Q(v.streamsProgress);for(var J=v.next();!J.done;J=v.next())J.value.streamState=U}return la8(d,K.filter(function(m){return!!m}),"offlineVideoStreams")}):g.qZ.resolve(void 0)}),
4)}if(e.X!=2)return g.RR(e,0);
Y=g.nP(e);return Y instanceof g.np&&Y.type==="QUOTA_EXCEEDED"?g.T(e,r.SO("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):e.FT(0)})},IsR=function(r,l){var U;
return g.y(function(F){if(!r.W)return F.return();U=r.W;return g.T(F,as(r.X,{mode:"readwrite",ag:!0},function(Y){var e=[p_(Y,U,"transfer")];l&&e.push(l(Y));return g.qZ.all(e)}),0)})},VR=function(r){r.W=void 0;
r.U=void 0;r.K.stop()},oKj=function(r,l){var U,F,Y,e,d;
return g.y(function(K){if(K.X==1)return U=g.QN(l.key),F=U.entityId,Y=g.Ea(F,"playbackData"),g.T(K,kG(r.X,Y,"playbackData"),2);e=K.W;if((d=e)==null?0:d.playerResponseJson)return K.return(JSON.parse(e.playerResponseJson));throw Error("No PlayerResponse found");})},zX=function(r,l){r.api.pP("woffle",{mcte:l});
F5("missing current transfer entity.")},SC=function(r,l){var U,F,Y;
return g.y(function(e){if(e.X==1)return g.T(e,kG(r.X,g.Ea(l,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);U=e.W;return e.return((Y=(F=U)==null?void 0:F.offlineModeType)!=null?Y:void 0)})},rTC=function(r){return eXb[r.transferState]!==void 0},$hq=function(r,l){var U=eXb[r.transferState],F=eXb[l.transferState];
return U!==F?U-F:Number(r.enqueuedTimestampMs)-Number(l.enqueuedTimestampMs)},to=function(r,l){var U=this;
this.WQ=r;this.api=l;this.D=new g.lt;this.U=new g.W$;this.wv={ql:function(){return U.L.wv.ql()},
D3:function(){return U.D},
zAN:function(){return U.L},
cF:function(){return U.cF()},
m2:function(){return U.m2()},
kS:function(){return U.kS()},
Fw:function(){return U.Fw()},
Lz:function(){return U.Lz()},
e3:function(F){return U.e3(F)}};
this.L=new S2p(function(){return dhb(U)},function(){U.kS()},this.api.Cg(),this.api.Y.bind(this.api));
this.W=new YO(this.api);z78(this.L)},dhb=function(r){return g.y(function(l){r.api.PQ("onOrchestrationBecameLeader");
return g.T(l,r.m2(),0)})},KZY=function(r){var l,U;
return g.y(function(F){if(F.X==1)return g.T(F,rx(),2);if(F.X!=3){l=F.W;if(!l)return F5("PES is undefined"),F.return();r.X=new ziY(l,r.api,r.L,r.W);U=r.rD(l);return g.T(F,nlG(l,U,r.L,r.W,r.WQ),3)}r.j=F.W;return g.T(F,OHY(r),0)})},OHY=function(r){var l;
return g.y(function(U){switch(U.X){case 1:if(!r.X)return F5("transferManager is undefined"),U.return();if(r.X.W){U.FT(2);break}return g.T(U,fq(r.X),2);case 2:if(!r.WQ.Y("woffle_enable_main_downloads_library")){U.FT(4);break}return g.T(U,r.ZU(),4);case 4:if(!r.WQ.Y("html5_offline_playback_position_sync")){U.FT(6);break}return g.T(U,r.E7(),7);case 7:return g.T(U,r.e3(864E5),6);case 6:return g.T(U,r.refreshAllStaleEntities(43200,!0),9);case 9:return g.T(U,r.xJ(),10);case 10:if(!r.WQ.Y("html5_retry_downloads_for_expiration")){U.FT(11);
break}return g.T(U,r.Lz(),11);case 11:return r.T=g.hZ(function(){r.refreshAllStaleEntities(43200,!0);r.xJ()},9E5),g.dd(g.Kp(),function(){return r.Fw()}),g.T(U,rx(),13);
case 13:return l=U.W,g.T(U,faf(l),14);case 14:p$8(r.L),g.Wm(U)}})},Cj0=function(){var r,l,U,F,Y,e;
return g.y(function(d){switch(d.X){case 1:return g.T(d,rx(),2);case 2:r=d.W;if(!r)return d.return([]);l=Date.now()/1E3;return g.T(d,oA(r,"offlineVideoPolicy"),3);case 3:U=d.W,F=g.Q(U),Y=F.next();case 4:if(Y.done){d.FT(6);break}e=Y.value;if(!(e.expirationTimestamp&&Number(e.expirationTimestamp)<l)){d.FT(5);break}e.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";e.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.T(d,Is(r,e,"offlineVideoPolicy"),5);
case 5:Y=F.next();d.FT(4);break;case 6:return d.return(U.map(function(K){return K.key}))}})},Lq=function(r,l,U,F,Y){var e,d,K;
return g.y(function(C){if(C.X==1)return g.T(C,rx(),2);e=C.W;if(!e)return C.return([]);d=l.map(function(v){var J=g.Ea(v,U);J={actionType:F,entityKey:J,actionMetadata:Object.assign({},FQp(),Y)};F!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(J.actionMetadata.priority=0);v=new xO(U,v,J);return QR(v)});
K=vtY(e,d);z78(r.L);return C.return(K)})},vKp=function(r,l,U,F){var Y,e,d,K,C,v,J,m;
return g.y(function(P){switch(P.X){case 1:Y=[],e=g.Q(l),d=e.next();case 2:if(d.done){P.FT(4);break}K=d.value;if(K.upToDate||U&&!K.shouldAutoSyncMetadata||!K.playlistId){P.FT(3);break}C={};switch(F){case "mainPlaylistEntity":v={nextAutoRefreshIntervalSeconds:K.checkInSeconds,autoSync:U};C={mainPlaylistEntityActionMetadata:v};break;case "musicPlaylist":J={autoSync:U},C={musicPlaylistEntityActionMetadata:J}}return g.T(P,Lq(r,[K.playlistId],F,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",C),6);case 6:(m=
P.W)&&Y.push.apply(Y,g.G(m));case 3:d=e.next();P.FT(2);break;case 4:return P.return(Y)}})},JTC=function(r,l){var U;
return g.y(function(F){return l.length?(U=FQp(),g.I3(U,yR,{isEnqueuedForExpiredStreamUrlRefetch:!0}),r.api.pP("qrd",{v:l.length}),F.return(Lq(r,l,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",U))):F.return([])})},mhY=function(r,l,U){this.W=r;
this.WQ=l;this.L=U},Mwq=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h;
return g.y(function(N){switch(N.X){case 1:return U=Cq(l),F=g.QN(l.entityKey),Y=F.entityId,e=[],g.QB(N,2),g.T(N,Pj8(r,Y),4);case 4:e=N.W;if(!(r.WQ.Y("woffle_enable_main_downloads_library")&&((d=e)==null?0:d.length))){N.FT(5);break}return g.T(N,sNb(r.W,[l.entityKey]),5);case 5:g.RR(N,3);break;case 2:return K=g.nP(N),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.np&&K.type==="QUOTA_EXCEEDED"?(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):F5("Playlist add error"),N.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,C,v));case 3:J=[];if(!r.WQ.Y("html5_offline_prevent_redownload_downloaded_video")){N.FT(7);break}return g.T(N,lFC(r.W,"mainVideoEntity",e),8);case 8:e=N.W;case 7:if((m=e)==null?0:m.length)for(P=g.Q(e),A=P.next();!A.done;A=P.next())if(M=A.value,E=M.offlineVideoData,Z=void 0,(Z=E)==null?0:Z.videoId)n=void 0,h=Number(((n=l.actionMetadata)==null?void 0:n.priority)||
0)+1,J.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",E.videoId,"mainVideoEntity",h,cR,ATb(l,E,Y)));return N.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,J))}})},xhp=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4,$$,Y$,L,Ae,G3,z3,RY,dR,XL,he,$0,R,d4,zp,Qk,iC,vb,g4,Tp,bC,X,b,q,B,S,Z3,r4,s4,lz,bz,cm,EY,EH,Tl,o9,tY,r0,h_,As,g0,s0,w0,LB,c7,uk,YR,le,Y8,q_,Iv;
return g.y(function(AY){switch(AY.X){case 1:return U=Cq(l),F=l.entityKey,Y=g.QN(F).entityId,e=[],d=!1,Y==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.T(AY,oA(r.W,"mainPlaylistEntity"),5)):g.T(AY,kG(r.W,F,"mainPlaylistEntity"),4);case 4:(K=AY.W)&&e.push(K);AY.FT(3);break;case 5:e=AY.W;case 3:if((C=e)==null||!C.length)return AY.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));v=g.V(l.actionMetadata,sv0);m=(J=v)==null?void 0:J.nextAutoRefreshIntervalSeconds;A=(P=v)==null?void 0:P.autoSync;M=[];Z=E=
!0;n=!1;if(!d&&A===!1){AY.FT(6);break}g.QB(AY,7);return g.T(AY,jNC(0,!!A,!0,e),9);case 9:M=AY.W;g.RR(AY,8);break;case 7:h=g.nP(AY);if(!(h instanceof Error&&h.message==="No data")){h instanceof Error&&h.message==="Empty response body"&&F5(h.message);AY.FT(8);break}return Y==="!*$_ALL_ENTITIES_!*$"?g.T(AY,va0(r.W,l,r.L,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.T(AY,KQ0(Y,r.W,l,r.L),8);case 8:if(!M.length||!d&&M[0].playlistId!==Y)return AY.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
U));case 6:if(d){N=[];u=g.Q(M);for(D=u.next();!D.done;D=u.next())t=D.value,t.upToDate||A&&!t.shouldAutoSyncMetadata||!t.playlistId||(z={nextAutoRefreshIntervalSeconds:t.checkInSeconds,autoSync:A},N.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t.playlistId,"mainPlaylistEntity",0,cR,{mainPlaylistEntityActionMetadata:z})));return AY.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,N))}M.length&&(I=M[0],n=!!I.upToDate,A&&(E=(U4=I.shouldAutoSyncMetadata)!=null?U4:!0,Z=($$=I.shouldAutoSyncVideos)!=
null?$$:!0,I.checkInSeconds&&(m=I.checkInSeconds)));if(n||!E)return AY.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));Y$=[];L=e[0];if(!L.downloadState){Ae=void 0;AY.FT(15);break}return g.T(AY,kG(r.W,L.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Ae=AY.W;case 15:return G3=Ae,RY=((z3=G3)==null?0:z3.addedTimestampMillis)?String(G3.addedTimestampMillis):void 0,g.QB(AY,17),g.T(AY,Pj8(r,Y,RY,m),19);case 19:Y$=AY.W;g.RR(AY,18);break;case 17:dR=g.nP(AY);if(!(dR instanceof
Error&&dR.message==="No data for playlist")){if(dR instanceof Error&&dR.message==="Empty response body for playlist")F5(dR.message);else return XL="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",he="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",dR instanceof g.np&&dR.type==="QUOTA_EXCEEDED"&&(XL="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",he="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),AY.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,XL,he));
AY.FT(18);break}return g.T(AY,KQ0(Y,r.W,l,r.L),18);case 18:if(!Z)return AY.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));$0=[];R=new Map;if((d4=Y$)==null?0:d4.length)for(zp=g.Q(Y$),Qk=zp.next();!Qk.done;Qk=zp.next())iC=Qk.value,vb=iC.offlineVideoData,g4=void 0,((g4=vb)==null?0:g4.videoId)&&R.set(vb.videoId,vb);Tp=new Map;bC=[];if((X=L)==null?0:(b=X.videos)==null?0:b.length)for(q=g.Q(L.videos),B=q.next();!B.done;B=q.next())if(S=B.value,Z3=JSON.parse(g.QN(S).entityId),r4=Z3.videoId)R.has(r4)?
(Tp.set(r4,R.get(r4)),R.delete(r4)):bC.push(r4);lz=Number(((s4=l.actionMetadata)==null?void 0:s4.priority)||0)+1;bz=g.Q(R.entries());for(cm=bz.next();!cm.done;cm=bz.next())EY=cm.value,EH=g.Q(EY),Tl=EH.next().value,o9=EH.next().value,tY=Tl,r0=o9,$0.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",tY,"mainVideoEntity",lz,cR,ATb(l,r0,Y)));h_=g.Q(Tp.entries());for(As=h_.next();!As.done;As=h_.next())g0=As.value,s0=g.Q(g0),w0=s0.next().value,LB=s0.next().value,c7=w0,uk=LB,$0.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
c7,"mainVideoEntity",lz,cR,ATb(l,uk,Y)));YR=g.Q(bC);for(le=YR.next();!le.done;le=YR.next())Y8=le.value,q_={playlistId:Y},Iv={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:q_},$0.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Y8,"mainVideoEntity",0,cR,Iv));return AY.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,$0))}})},WZ$=function(r,l){var U,F,Y,e;
return g.y(function(d){switch(d.X){case 1:return U=Cq(l),g.QB(d,2),F=g.QN(l.entityKey).entityId,F==="!*$_ALL_ENTITIES_!*$"?g.T(d,va0(r.W,l,r.L,(Y=l.actionMetadata)==null?void 0:(e=Y.offlineLoggingData)==null?void 0:e.offlineDeleteReason),5):g.T(d,KQ0(F,r.W,l,r.L),6);case 6:if(!r.WQ.Y("woffle_enable_main_downloads_library")){d.FT(5);break}return g.T(d,x_Y(r.W,l.entityKey),5);case 5:g.RR(d,3);break;case 2:return g.nP(d),d.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U))}})},Pj8=function(r,l,U,F){var Y,e,d,K,C,v,J;
return g.y(function(m){switch(m.X){case 1:return g.T(m,b0C([l]),2);case 2:return Y=m.W,g.T(m,Qvf(r,Y[0],U,F),3);case 3:return e=m.W,d=e.mainPlaylistEntity,K=e.Thw,v=d_$(d,(C=K)==null?void 0:C.avatar),g.QB(m,4),g.T(m,Zp(v),6);case 6:g.RR(m,5);break;case 4:J=g.nP(m),J instanceof Error&&J.message==="Failed to fetch"&&F5(J.message);case 5:return m.return(Y[0].videos)}})},Qvf=function(r,l,U,F){var Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u;
return g.y(function(D){switch(D.X){case 1:Y=Date.now().toString();U||(U=Y);e=l.videos;d=l.playlistId;K=[];C=[];if(e)for(v=g.Q(e),J=v.next();!J.done;J=v.next()){m=J.value;P=m.offlineVideoData;if(!P||!P.videoId)throw F5("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");A=P.videoId;M={videoId:A,playlistId:d};E={id:g.Ea(JSON.stringify(M),"mainPlaylistVideoEntity"),video:g.Ea(A,"mainVideoEntity")};K.push(E);C.push(E.id)}n={key:g.Ea(d,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:U,lastSyncedTimestampMillis:Y};h={key:g.Ea(d,"mainPlaylistEntity"),playlistId:d,videos:C,title:l.title,thumbnailStyleData:EKY(l),visibility:ZHp(l),downloadState:n.key};l.channel&&(N=l.channel.offlineChannelData,Z=RXR(g.Ea(d,"ytMainChannelEntity"),N),h.channelOwner=Z.id);((u=h)==null?0:u.entityMetadata)?(h.entityMetadata.offlineLastModifiedTimestampSeconds=l.lastModifiedTimestamp,F&&(h.entityMetadata.nextAutoRefreshIntervalSeconds=String(F))):h&&(h.entityMetadata={nextAutoRefreshIntervalSeconds:F?
String(F):void 0,offlineLastModifiedTimestampSeconds:l.lastModifiedTimestamp});g.QB(D,2);return g.T(D,as(r.W,{mode:"readwrite",ag:!0},function(t){var z=p_(t,h,"mainPlaylistEntity"),I=p_(t,n,"mainPlaylistDownloadStateEntity");z=[z,I];I=g.Q(K);for(var U4=I.next();!U4.done;U4=I.next())z.push(p_(t,U4.value,"mainPlaylistVideoEntity"));Z&&z.push(p_(t,Z,"ytMainChannelEntity"));return g.qZ.all(z)}),4);
case 4:g.RR(D,3);break;case 2:throw g.nP(D),F5("PES failure for playlist"),Error("PES failure for playlist");case 3:return D.return({mainPlaylistEntity:h,Thw:Z,qHz:K})}})},RXR=function(r,l){return{id:r,
channelId:l.channelId,title:l.title,avatar:l.thumbnail}},EKY=function(r){var l=[],U=r.videos;
U&&U.length>0&&l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:U[0].offlineVideoData.thumbnail}}});if((r=r.additionalMetadadatas)&&r.length>0)for(r=g.Q(r),U=r.next();!U.done;U=r.next()){var F=U.value.offlineBundleItemPlaylistData,Y=void 0;U=(Y=F)==null?void 0:Y.style;Y=void 0;F={collageThumbnail:{coverThumbnail:(Y=F)==null?void 0:Y.coverThumbnail}};switch(U){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:F});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:F});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:F});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:F})}}return l},ZHp=function(r){switch(r.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},ATb=function(r,l,U){l={offlineVideoData:l,
playlistId:U};if(r=g.V(r.actionMetadata,sv0))l.maximumDownloadQuality=r.maximumDownloadQuality;return{mainVideoEntityActionMetadata:l}},hXY=function(r,l,U){this.W=r;
this.WQ=l;this.L=U},XOp=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M;
return g.y(function(E){switch(E.X){case 1:return U=Cq(l),F=g.QN(l.entityKey),Y=F.entityId,e=g.V(l.actionMetadata,aA),K=!((d=e)==null?0:d.playlistId),g.QB(E,2),g.T(E,nKj(r,Y,void 0,(C=e)==null?void 0:C.offlineVideoData,K),4);case 4:g.RR(E,3);break;case 2:return v=g.nP(E),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.np&&v.type==="QUOTA_EXCEEDED"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
E.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,J,m));case 3:P=1;P=Number(((A=l.actionMetadata)==null?void 0:A.priority)||0)+1;var Z=(Z=g.V(l.actionMetadata,aA))?{playbackDataActionMetadata:{maximumDownloadQuality:Z.maximumDownloadQuality}}:void 0;M=TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y,"playbackData",P,Gbf,Z);return E.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,[M]))}})},iHf=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h;
return g.y(function(N){switch(N.X){case 1:return U=Cq(l),F=g.QN(l.entityKey),Y=F.entityId,g.T(N,kG(r.W,l.entityKey,"mainVideoEntity"),2);case 2:e=N.W;if(!e){d=void 0;N.FT(3);break}return g.T(N,kG(r.W,e.downloadState,"mainVideoDownloadStateEntity"),4);case 4:d=N.W;case 3:K=d;if(!e||!K)return N.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));g.QB(N,5);return g.T(N,nKj(r,Y,K.addedTimestampMillis,(v=g.V(l.actionMetadata,aA))==null?void 0:v.offlineVideoData),7);case 7:J=1;J=Number(((m=
l.actionMetadata)==null?void 0:m.priority)||0)+1;C=TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Y,"playbackData",J,Gbf);g.RR(N,6);break;case 5:P=g.nP(N);if(!(P instanceof Error&&P.message==="No data")){if(P instanceof Error&&P.message==="Empty response body")F5(P.message);else return A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",P instanceof g.np&&P.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),N.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,A,M));N.FT(6);break}return g.T(N,nq(r.W,Y),9);case 9:E=N.W;Z=g.V(l.actionMetadata,aA);if(h=(n=Z)==null?void 0:n.playlistId)E.playlistId=h;E.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.T(N,RA(Y,r.W,l,r.L,E),6);case 6:return N.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,C?[C]:void 0))}})},bHf=function(r,l){var U,F,Y,e,d,K,C,v,J,m;
return g.y(function(P){switch(P.X){case 1:return U=Cq(l),g.QB(P,2),F=g.QN(l.entityKey).entityId,F==="!*$_ALL_ENTITIES_!*$"?g.T(P,va0(r.W,l,r.L,(J=l.actionMetadata)==null?void 0:(m=J.offlineLoggingData)==null?void 0:m.offlineDeleteReason),5):g.T(P,nq(r.W,F),6);case 6:Y=P.W;e=g.V(l.actionMetadata,aA);if(K=(d=e)==null?void 0:d.playlistId)Y.playlistId=K;Y.offlineDeleteReason=(C=l.actionMetadata)==null?void 0:(v=C.offlineLoggingData)==null?void 0:v.offlineDeleteReason;return g.T(P,RA(F,r.W,l,r.L,Y),7);
case 7:if(!r.WQ.Y("woffle_enable_main_downloads_library")){P.FT(5);break}return g.T(P,x_Y(r.W,l.entityKey),5);case 5:g.RR(P,3);break;case 2:return g.nP(P),P.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U))}})},nKj=function(r,l,U,F,Y){var e,d,K,C,v,J;
return g.y(function(m){switch(m.X){case 1:if(e=F){m.FT(2);break}return g.T(m,i0p([l]),3);case 3:d=m.W,e=d[0];case 2:return g.T(m,NXq(r,e,U,Y),4);case 4:K=m.W;C=K.mainVideoEntity;v=K.channelEntity;g.QB(m,5);var P=s8(C.thumbnail),A=s8(v.avatar);return g.T(m,Zp(P.concat(A)),7);case 7:g.RR(m,0);break;case 5:J=g.nP(m),J instanceof Error&&J.message==="Failed to fetch"&&F5(J.message),g.Wm(m)}})},NXq=function(r,l,U,F){var Y,e,d,K,C,v,J,m,P,A,M,E,Z;
return g.y(function(n){switch(n.X){case 1:U||(U=Date.now().toString());e=(Y=l.channel)==null?void 0:Y.offlineChannelData;d={id:g.Ea(l.videoId,"ytMainChannelEntity"),channelId:e.channelId,title:e.title,avatar:e.thumbnail};K={key:g.Ea(l.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Ea(l.videoId,"playbackData"),addedTimestampMillis:U,videoDownloadContextEntity:g.Ea(l.videoId,"videoDownloadContextEntity")};C={key:g.Ea(l.videoId,"videoPlaybackPositionEntity"),videoId:l.videoId,lastPlaybackPositionSeconds:"0"};
r.WQ.Y("html5_offline_playback_position_sync")&&(v={playbackPosition:C.key});J=g.Ea(l.videoId,"mainVideoEntity");m={key:J,videoId:l.videoId,title:l.title,thumbnail:l.thumbnail,localizedStrings:{viewCount:l.shortViewCountText},userState:v,lengthSeconds:l.lengthSeconds?Number(l.lengthSeconds):void 0,publishedTimestampMillis:l.publishedTimestamp?(Number(l.publishedTimestamp)*1E3).toString():void 0,formattedDescription:l.description,owner:d.id,downloadState:K.key};if(!r.WQ.Y("woffle_enable_main_downloads_library")||
!F){n.FT(2);break}return g.T(n,M68(r.W,[J]),3);case 3:if(M=n.W)P=M.mainDownloadsLibraryEntity,A=M.mainDownloadsListEntity;case 2:return Z=$_$,E={key:g.Ea(l.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.I3(K,Z,E),g.T(n,as(r.W,{mode:"readwrite",ag:!0},function(h){var N=p_(h,d,"ytMainChannelEntity"),u=p_(h,K,"mainVideoDownloadStateEntity"),D=p_(h,m,"mainVideoEntity");N=[N,u,D];r.WQ.Y("html5_offline_playback_position_sync")&&(u=p_(h,C,"videoPlaybackPositionEntity"),
N.push(u));P&&(u=p_(h,P,"mainDownloadsLibraryEntity"),N.push(u));A&&(u=p_(h,A,"mainDownloadsListEntity"),N.push(u));E&&(h=p_(h,E,"downloadStatusEntity"),N.push(h));return g.qZ.all(N)}),4);
case 4:return n.return({mainVideoEntity:m,channelEntity:d})}})},jv$=function(r,l,U){this.W=r;
this.WQ=l;this.L=U},TX$=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4,$$,Y$,L;
return g.y(function(Ae){switch(Ae.X){case 1:return U=Cq(l),F=[],g.T(Ae,wt.getInstance(),2);case 2:Y=Ae.W;if(!Y){Ae.FT(3);break}return g.T(Ae,Y.get("sdois"),4);case 4:return e=Ae.W,g.T(Ae,(K=Y)==null?void 0:K.get("lmqf"),5);case 5:d=Ae.W;case 3:g.QB(Ae,6);if(e===void 0)throw Error("prefStorage or opt-in state is undefined");C=[];if(e){Ae.FT(8);break}return g.T(Ae,Az8(r.W),9);case 9:C=Ae.W,C.reverse();case 8:if(!C.length){Ae.FT(10);break}v=g.Q(C);J=v.next();case 11:if(J.done){Ae.FT(10);break}m=J.value;
if(!m){Ae.FT(12);break}P=g.QN(m).entityId;return g.T(Ae,nq(r.W,P),14);case 14:return A=Ae.W,A.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.T(Ae,RA(P,r.W,{entityKey:m,actionType:l.actionType},r.L,A),12);case 12:J=v.next();Ae.FT(11);break;case 10:return g.T(Ae,Tcf(e,(M=d)!=null?M:"SD"),16);case 16:return E=Ae.W,g.T(Ae,JzY(E),17);case 17:Z=PUf(E);if(!r.WQ.Y("woffle_enable_main_downloads_library")){Ae.FT(18);break}if(e){Ae.FT(19);break}return g.T(Ae,x_Y(r.W,g.DS),19);case 19:return g.T(Ae,
sNb(r.W,[g.DS]),18);case 18:if((n=Z)==null?0:n.length)for(h=g.Q(Z),N=h.next();!N.done;N=h.next())if(D=u=N.value,t=D.actionType,z=D.entityKey,I=D.actionMetadata,t&&z&&I&&!g.V(I,qW8)){t==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(I.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(U4=g.V(u.actionMetadata,aA))U4.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",u.actionMetadata=Object.assign({},u.actionMetadata,{mainVideoEntityActionMetadata:U4});F.push(u)}g.RR(Ae,
7);break;case 6:return $$=g.nP(Ae),Y$="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",$$ instanceof g.np&&$$.type==="QUOTA_EXCEEDED"&&(Y$="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ae.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,Y$,L));case 7:return Ae.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,F))}})},uXp=function(){to.apply(this,
arguments);
this.V="mainVideoEntity"},yT0=function(r,l,U){l=l===void 0?43200:l;
U=U===void 0?!0:U;var F=F===void 0?!1:F;var Y,e,d;return g.y(function(K){switch(K.X){case 1:if(!r.D.i6())return K.return([]);Y=[];g.QB(K,2);return g.T(K,jNC(l,U,F),4);case 4:Y=K.W;g.RR(K,3);break;case 2:e=g.nP(K),e instanceof Error&&e.message==="No data"||e instanceof Error&&e.message==="Empty response body"&&F5(e.message);case 3:return d=vKp(r,Y,U,"mainPlaylistEntity"),K.return(d)}})},BXr=function(r,l,U,F){F=F===void 0?!1:F;
var Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h;return g.y(function(N){switch(N.X){case 1:return Y=[],g.T(N,qej(),2);case 2:return(e=N.W)||F?g.T(N,up0(l,U),3):N.return([]);case 3:d=N.W;if((K=d)==null||!K.length)return N.return([]);C={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};v=g.Q(d);J=v.next();case 4:if(J.done){N.FT(6);break}P=m=J.value;A=P.actionType;M=P.entityKey;E=P.actionMetadata;if(!(A&&M&&E)||g.V(E,qW8)){N.FT(5);break}A==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(E.offlineLoggingData=
C);Z=g.QN(M);n=Z.entityId;return g.T(N,Lq(r,[n],"mainVideoEntity",A,E),8);case 8:h=N.W,Y=Y.concat(h);case 5:J=v.next();N.FT(4);break;case 6:return N.return(Y)}})},HHp=function(r,l){this.W=r;
this.L=l},wOb=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n;
return g.y(function(h){switch(h.X){case 1:return U=Cq(l),F=g.QN(l.entityKey),Y=F.entityId,e=[],g.QB(h,2),g.T(h,gKr(r,Y),4);case 4:e=h.W;if((d=e)==null||!d.length){h.FT(5);break}return g.T(h,Rtq(r.W,l.entityKey),5);case 5:g.RR(h,3);break;case 2:return K=g.nP(h),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.np&&K.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
h.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,C,v));case 3:return J=[],g.T(h,lFC(r.W,"musicTrack",e),7);case 7:e=h.W;if(e.length)for(m=g.Q(e),P=m.next();!P.done;P=m.next())if(A=P.value,M=A.offlineVideoData,E=void 0,(E=M)==null?0:E.videoId)Z=void 0,n=Number(((Z=l.actionMetadata)==null?void 0:Z.priority)||0)+1,J.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M.videoId,"musicTrack",n,IA,b6(l,M,Y)));return h.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,J))}})},
DhC=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4,$$,Y$,L,Ae,G3,z3,RY,dR,XL,he,$0,R,d4,zp,Qk,iC,vb,g4,Tp,bC,X,b,q,B,S,Z3,r4,s4,lz,bz,cm,EY,EH,Tl,o9;
return g.y(function(tY){switch(tY.X){case 1:return U=Cq(l),F=l.entityKey,Y=g.QN(F).entityId,e=[],d=!1,Y==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.T(tY,oA(r.W,"musicAlbumRelease"),5)):g.T(tY,kG(r.W,F,"musicAlbumRelease"),4);case 4:(K=tY.W)&&e.push(K);tY.FT(3);break;case 5:e=tY.W;case 3:if((C=e)==null||!C.length)return tY.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));if(d){v=[];J=g.Q(e);for(m=J.next();!m.done;m=J.next())P=m.value,A=g.QN(P.id).entityId,v.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
A,"musicAlbumRelease",0,IA));return tY.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,v))}M=[];E=e[0];Z=void 0;if(!E.downloadMetadata){tY.FT(6);break}return g.T(tY,kG(r.W,E.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:n=tY.W,Z=Number((N=(h=n)==null?void 0:h.addedTimestampMillis)!=null?N:"0")/1E3;case 6:return g.QB(tY,8),g.T(tY,gKr(r,Y,(u=Z)==null?void 0:u.toString()),10);case 10:M=tY.W;g.RR(tY,9);break;case 8:D=g.nP(tY);if(!(D instanceof Error&&D.message===
"No data")){if(D instanceof Error&&D.message==="Empty response body")F5(D.message);else return t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.np&&D.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),tY.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,t,z));tY.FT(9);break}return g.T(tY,X5(Y,"musicAlbumRelease",r.W,
l,r.L),9);case 9:I=[];U4=new Map;if(($$=M)==null?0:$$.length)for(Y$=g.Q(M),L=Y$.next();!L.done;L=Y$.next())Ae=L.value,G3=Ae.offlineVideoData,z3=void 0,((z3=G3)==null?0:z3.videoId)&&U4.set(G3.videoId,G3);RY=new Map;dR=[];if((XL=E)==null?0:(he=XL.tracks)==null?0:he.length)for($0=g.Q(E.tracks),R=$0.next();!R.done;R=$0.next())if(d4=R.value,zp=g.QN(d4).entityId)U4.has(zp)?(RY.set(zp,U4.get(zp)),U4.delete(zp)):dR.push(zp);iC=Number(((Qk=l.actionMetadata)==null?void 0:Qk.priority)||0)+1;vb=g.Q(U4.entries());
for(g4=vb.next();!g4.done;g4=vb.next())Tp=g4.value,bC=g.Q(Tp),X=bC.next().value,b=bC.next().value,q=X,B=b,I.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q,"musicTrack",iC,IA,b6(l,B)));S=g.Q(RY.entries());for(Z3=S.next();!Z3.done;Z3=S.next())r4=Z3.value,s4=g.Q(r4),lz=s4.next().value,bz=s4.next().value,cm=lz,EY=bz,I.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",cm,"musicTrack",iC,IA,b6(l,EY)));EH=g.Q(dR);for(Tl=EH.next();!Tl.done;Tl=EH.next())o9=Tl.value,I.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
o9,"musicTrack",0,IA));return tY.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,I))}})},Vw$=function(r,l){var U,F;
return g.y(function(Y){switch(Y.X){case 1:return U=Cq(l),g.QB(Y,2),F=g.QN(l.entityKey).entityId,F==="!*$_ALL_ENTITIES_!*$"?g.T(Y,i6(r.W,l,r.L),5):g.T(Y,X5(F,"musicAlbumRelease",r.W,l,r.L),6);case 6:return g.T(Y,htf(r.W,l.entityKey),5);case 5:g.RR(Y,3);break;case 2:return g.nP(Y),Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
U))}})},gKr=function(r,l,U){var F,Y,e;
return g.y(function(d){switch(d.X){case 1:return g.T(d,b0C([l]),2);case 2:return F=d.W,g.T(d,fy8(r,F[0],U),3);case 3:return Y=d.W,e=s8(Y.thumbnailDetails),g.T(d,Zp(e),4);case 4:return d.return(F[0].videos)}})},fy8=function(r,l,U){var F,Y,e,d,K,C,v,J,m,P,A,M,E,Z;
return g.y(function(n){if(n.X==1){F=l.additionalMetadadatas;Y=void 0;if(F&&F.length>0)for(e=g.Q(F),d=e.next();!d.done;d=e.next())if(K=d.value,K.offlineMusicPlaylistData){Y=K.offlineMusicPlaylistData;break}C=l.playlistId;v=naC(l);J=v.F_;m=v.Z5;P=U?(Number(U)*1E3).toString():Date.now().toString();A=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0";M={id:g.Ea(C,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:m,lastModifiedTimestampMillis:A,addedTimestampMillis:P,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};E={id:g.Ea(C,"musicAlbumRelease"),title:l.title,audioPlaylistId:C,trackCount:l.totalVideoCount,tracks:J,downloadMetadata:M.id};Y&&(E.thumbnailDetails=(Z=Y.albumHqThumbnail)!=null?Z:Y.albumArtistThumbnail,E.artistDisplayName=Y.albumArtistDisplayName,E.releaseDate=Y.albumReleaseDate,E.contentRating={explicitType:Y.albumReleaseExplicitType},E.releaseType=Y.albumReleaseType);return g.T(n,as(r.W,{mode:"readwrite",ag:!0},function(h){var N=p_(h,E,"musicAlbumRelease");
h=p_(h,M,"musicAlbumReleaseDownloadMetadataEntity");return g.qZ.all([N,h])}),2)}return n.return(E)})},SWq=function(r,l){this.W=r;
this.L=l},pOj=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n;
return g.y(function(h){switch(h.X){case 1:return U=Cq(l),F=g.QN(l.entityKey),Y=F.entityId,e=[],g.QB(h,2),g.T(h,zXq(r,Y),4);case 4:e=h.W;if((d=e)==null||!d.length){h.FT(5);break}return g.T(h,Rtq(r.W,l.entityKey),5);case 5:g.RR(h,3);break;case 2:return K=g.nP(h),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.np&&K.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
h.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,C,v));case 3:return J=[],g.T(h,lFC(r.W,"musicTrack",e),7);case 7:e=h.W;if(e.length)for(m=g.Q(e),P=m.next();!P.done;P=m.next())if(A=P.value,M=A.offlineVideoData,E=void 0,(E=M)==null?0:E.videoId)Z=void 0,n=Number(((Z=l.actionMetadata)==null?void 0:Z.priority)||0)+1,J.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M.videoId,"musicTrack",n,kO,b6(l,M,Y)));return h.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,J))}})},
tw$=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4,$$,Y$,L,Ae,G3,z3,RY,dR,XL,he,$0,R,d4,zp,Qk,iC,vb,g4,Tp,bC,X,b,q,B,S,Z3,r4,s4,lz,bz,cm,EY,EH,Tl,o9,tY,r0,h_,As,g0,s0,w0,LB,c7,uk,YR,le;
return g.y(function(Y8){switch(Y8.X){case 1:return U=Cq(l),F=l.entityKey,Y=g.QN(F).entityId,e=[],d=!1,Y==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.T(Y8,oA(r.W,"musicPlaylist"),5)):g.T(Y8,kG(r.W,F,"musicPlaylist"),4);case 4:(K=Y8.W)&&e.push(K);Y8.FT(3);break;case 5:e=Y8.W;case 3:if((C=e)==null||!C.length)return Y8.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));v=g.V(l.actionMetadata,Gdb);m=(J=v)==null?void 0:J.autoSync;P=[];M=A=!0;E=!1;Z=void 0;if(!d&&m===!1){Y8.FT(6);break}g.QB(Y8,7);return g.T(Y8,
yzp(0,!!m,!0,e),9);case 9:P=Y8.W;g.RR(Y8,8);break;case 7:n=g.nP(Y8);if(!(n instanceof Error&&n.message==="No data")){n instanceof Error&&n.message==="Empty response body"&&F5(n.message);Y8.FT(8);break}return Y==="!*$_ALL_ENTITIES_!*$"?g.T(Y8,i6(r.W,l,r.L),8):g.T(Y8,X5(Y,"musicPlaylist",r.W,l,r.L),8);case 8:if(!P.length||!d&&P[0].playlistId!==Y)return Y8.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));case 6:if(d){h=[];N=g.Q(P);for(u=N.next();!u.done;u=N.next())D=u.value,D.upToDate||
m&&!D.shouldAutoSyncMetadata||!D.playlistId||(t={autoSync:m},h.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D.playlistId,"musicPlaylist",0,kO,{musicPlaylistEntityActionMetadata:t})));return Y8.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,h))}P.length&&(z=P[0],E=!!z.upToDate,m&&(A=(I=z.shouldAutoSyncMetadata)!=null?I:!0,M=(U4=z.shouldAutoSyncVideos)!=null?U4:!0,z.checkInSeconds&&(Z=z.checkInSeconds)));if(E||!A)return Y8.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
U));$$=[];Y$=e[0];L=void 0;if(!Y$.downloadMetadata){Y8.FT(15);break}return g.T(Y8,kG(r.W,Y$.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Ae=Y8.W,L=Number((z3=(G3=Ae)==null?void 0:G3.addedTimestampMillis)!=null?z3:"0")/1E3;case 15:return g.QB(Y8,17),g.T(Y8,zXq(r,Y,(RY=L)==null?void 0:RY.toString(),Z),19);case 19:$$=Y8.W;g.RR(Y8,18);break;case 17:dR=g.nP(Y8);if(!(dR instanceof Error&&dR.message==="No data")){if(dR instanceof Error&&dR.message==="Empty response body")F5(dR.message);
else return XL="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",he="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",dR instanceof g.np&&dR.type==="QUOTA_EXCEEDED"&&(XL="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",he="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Y8.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,XL,he));Y8.FT(18);break}return g.T(Y8,X5(Y,"musicPlaylist",r.W,l,r.L),18);case 18:if(!M)return Y8.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
U));$0=[];R=new Map;if((d4=$$)==null?0:d4.length)for(zp=g.Q($$),Qk=zp.next();!Qk.done;Qk=zp.next())iC=Qk.value,vb=iC.offlineVideoData,g4=void 0,((g4=vb)==null?0:g4.videoId)&&R.set(vb.videoId,vb);Tp=new Map;bC=[];if((X=Y$)==null?0:(b=X.tracks)==null?0:b.length)for(q=g.Q(Y$.tracks),B=q.next();!B.done;B=q.next())if(S=B.value,Z3=g.QN(S).entityId)R.has(Z3)?(Tp.set(Z3,R.get(Z3)),R.delete(Z3)):bC.push(Z3);s4=Number(((r4=l.actionMetadata)==null?void 0:r4.priority)||0)+1;lz=g.Q(R.entries());for(bz=lz.next();!bz.done;bz=
lz.next())cm=bz.value,EY=g.Q(cm),EH=EY.next().value,Tl=EY.next().value,o9=EH,tY=Tl,$0.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",o9,"musicTrack",s4,kO,b6(l,tY)));r0=g.Q(Tp.entries());for(h_=r0.next();!h_.done;h_=r0.next())As=h_.value,g0=g.Q(As),s0=g0.next().value,w0=g0.next().value,LB=s0,c7=w0,$0.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",LB,"musicTrack",s4,kO,b6(l,c7)));uk=g.Q(bC);for(YR=uk.next();!YR.done;YR=uk.next())le=YR.value,$0.push(TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
le,"musicTrack",0,kO));return Y8.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,$0))}})},LZp=function(r,l){var U,F;
return g.y(function(Y){switch(Y.X){case 1:return U=Cq(l),g.QB(Y,2),F=g.QN(l.entityKey).entityId,F==="!*$_ALL_ENTITIES_!*$"?g.T(Y,i6(r.W,l,r.L),5):g.T(Y,X5(F,"musicPlaylist",r.W,l,r.L),6);case 6:return g.T(Y,htf(r.W,l.entityKey),5);case 5:g.RR(Y,3);break;case 2:return g.nP(Y),Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
U))}})},zXq=function(r,l,U,F){var Y,e,d;
return g.y(function(K){switch(K.X){case 1:return g.T(K,b0C([l]),2);case 2:return Y=K.W,g.T(K,cT0(r,Y[0],U,F),3);case 3:return e=K.W,d=s8(e.thumbnailDetails),g.T(K,Zp(d),4);case 4:return K.return(Y[0].videos)}})},cT0=function(r,l,U,F){var Y,e,d,K,C,v,J,m,P;
return g.y(function(A){return A.X==1?(Y=l.playlistId,e=naC(l),d=e.F_,K=e.Z5,C=U?(Number(U)*1E3).toString():Date.now().toString(),v=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0",J={id:g.Ea(Y,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:K,lastModifiedTimestampMillis:v,addedTimestampMillis:C,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},m={id:g.Ea(Y,"musicPlaylist"),title:l.title,playlistId:Y,thumbnailDetails:l.thumbnail,visibility:ayb(l),trackCount:l.totalVideoCount,
tracks:d,downloadMetadata:J.id},F&&(((P=m)==null?0:P.entityMetadata)?m.entityMetadata.nextAutoRefreshIntervalSeconds=String(F):m&&(m.entityMetadata={nextAutoRefreshIntervalSeconds:String(F)})),g.T(A,as(r.W,{mode:"readwrite",ag:!0},function(M){var E=p_(M,m,"musicPlaylist");M=p_(M,J,"musicPlaylistDownloadMetadataEntity");return g.qZ.all([E,M])}),2)):A.return(m)})},ayb=function(r){switch(r.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},IyY=function(r,l){this.W=r;
this.L=l},$3C=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M;
return g.y(function(E){switch(E.X){case 1:return U=Cq(l),F=g.QN(l.entityKey),Y=F.entityId,e=g.V(l.actionMetadata,kbr),g.QB(E,2),g.T(E,oc8(r,Y,void 0,(d=e)==null?void 0:d.track,(K=e)==null?void 0:K.albumRelease),4);case 4:if((C=e)==null?0:C.playlistId){E.FT(5);break}return g.T(E,Rtq(r.W,l.entityKey),5);case 5:g.RR(E,3);break;case 2:return v=g.nP(E),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.np&&v.type==="QUOTA_EXCEEDED"&&
(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),E.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,J,m));case 3:A=Number(((P=l.actionMetadata)==null?void 0:P.priority)||0)+1;var Z=(Z=g.V(l.actionMetadata,kbr))?{playbackDataActionMetadata:{maximumDownloadQuality:Z.maximumDownloadQuality}}:void 0;M=TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y,"playbackData",A,rZq,Z);return E.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
U,[M]))}})},lib=function(r,l){var U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z;
return g.y(function(n){switch(n.X){case 1:return U=Cq(l),F=g.QN(l.entityKey),Y=F.entityId,g.T(n,kG(r.W,l.entityKey,"musicTrack"),2);case 2:e=n.W;if(!e){d=void 0;n.FT(3);break}return g.T(n,kG(r.W,e.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:d=n.W;case 3:K=d;if(!e||!K)return n.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U));v=g.V(l.actionMetadata,kbr);g.QB(n,5);return g.T(n,oc8(r,Y,K.addedTimestampMillis,(J=v)==null?void 0:J.track,(m=v)==null?void 0:m.albumRelease),
7);case 7:A=Number(((P=l.actionMetadata)==null?void 0:P.priority)||0)+1;C=TX("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Y,"playbackData",A,rZq);g.RR(n,6);break;case 5:M=g.nP(n);if(!(M instanceof Error&&M.message==="No data")){if(M instanceof Error&&M.message==="Empty response body")F5(M.message);else return E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.np&&M.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),n.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,E,Z));n.FT(6);break}return g.T(n,GX(Y,r.W,l,r.L),6);case 6:return n.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",U,C?[C]:void 0))}})},U3r=function(r,l){var U,F;
return g.y(function(Y){switch(Y.X){case 1:return U=Cq(l),g.QB(Y,2),F=g.QN(l.entityKey).entityId,F==="!*$_ALL_ENTITIES_!*$"?g.T(Y,i6(r.W,l,r.L),5):g.T(Y,GX(F,r.W,l,r.L),6);case 6:return g.T(Y,htf(r.W,l.entityKey),5);case 5:g.RR(Y,3);break;case 2:return g.nP(Y),Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",U,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
U))}})},oc8=function(r,l,U,F,Y){var e,d,K,C,v,J;
return g.y(function(m){switch(m.X){case 1:if(e=F){m.FT(2);break}return g.T(m,i0p([l]),3);case 3:d=m.W,K=d[0],e=Z0Y(K);case 2:return g.T(m,FzR(r,e,l,Y,U),4);case 4:C=m.W;v=C.musicTrackEntity;J=C.TF;var P=s8(v.thumbnailDetails),A=[];J&&(A=s8(J.thumbnailDetails));return g.T(m,Zp(P.concat(A)),0)}})},FzR=function(r,l,U,F,Y){var e;
return g.y(function(d){return d.X==1?(Y||(Y=Date.now().toString()),e={id:g.Ea(U,"musicTrackDownloadMetadataEntity"),playbackData:g.Ea(U,"playbackData"),addedTimestampMillis:Y,videoDownloadContextEntity:g.Ea(U,"videoDownloadContextEntity")},F&&(l.albumRelease=F.id),g.T(d,as(r.W,{mode:"readwrite",ag:!0},function(K){var C=[],v=p_(K,e,"musicTrackDownloadMetadataEntity");C.push(v);v=p_(K,l,"musicTrack");C.push(v);F&&(K=p_(K,F,"musicAlbumRelease"),C.push(K));return g.qZ.all(C)}),2)):d.X!=3?g.T(d,PR(U,"musicTrackDownloadMetadataEntity",
r.W,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):d.return({musicTrackEntity:l,
TF:F})})},oG=function(){to.apply(this,arguments);
this.V="musicTrack"},YmY=function(r,l,U){l=l===void 0?43200:l;
U=U===void 0?!0:U;var F=F===void 0?!1:F;var Y,e;return g.y(function(d){switch(d.X){case 1:if(!r.D.i6())return d.return([]);Y=[];g.QB(d,2);return g.T(d,yzp(l,U,F),4);case 4:Y=d.W;g.RR(d,3);break;case 2:g.nP(d);case 3:return e=vKp(r,Y,U,"musicPlaylist"),d.return(e)}})},e_Y=function(){g.Rf.apply(this,arguments);
var r=this;this.events=new g.Lg(this);this.WQ=this.player.N();this.wv={oVN:function(){return r.W},
S1:function(){return r.S1()},
dF:function(l){return r.dF(l)}}},d3C=function(r){var l;
r=g.V((l=r.getWatchNextResponse())==null?void 0:l.currentVideoEndpoint,g.Kk);if(r==null?0:r.playlistId)var U=r.playlistId;return U},O1f=function(r,l){var U,F,Y,e;
return g.y(function(d){if(d.X==1){U=l.clientPlaybackNonce;F={cpn:U,offlineSourceVisualElement:g.Tz(l.iG||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};l.X&&(F.videoFmt=Number(l.X.itag));l.K&&(F.audioFmt=Number(l.K.itag));if((Y=d3C(l))&&l.videoId){var K=l.videoId;K=Y!=="PPSV"?Promise.resolve(!1):r.W.eY(K);d=g.T(d,K,3)}else d=d.FT(2);return d}d.X!=2&&(e=d.W)&&(F.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");r.X=U;g.xC("offlinePlaybackStarted",F);g.Wm(d)})};
g.yy.prototype.f5=g.FL(45,function(r){return this.app.f5(r)});
g.QP.prototype.f5=g.FL(44,function(r){return g.EuP(this,9,r)});
g.W(Hk,Bk);g.eS.Object.defineProperties(Hk.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.W.entityMetadata},
set:function(r){this.W.entityMetadata=r}}});
g.W(k9f,Hk);k9f.prototype.X=function(){return[]};
g.W(oAr,Hk);oAr.prototype.X=function(){return[]};
g.W(rg8,Hk);rg8.prototype.X=function(){return[]};
g.W($d0,Hk);$d0.prototype.X=function(){return[]};
g.W(lwb,Hk);lwb.prototype.X=function(){var r=[];this.W.alternateChannel&&r.push(this.W.alternateChannel);this.W.alternateChannelList&&r.push.apply(r,g.G(this.W.alternateChannelList));this.W.oneofChannelEntity&&r.push(this.W.oneofChannelEntity);return[].concat(g.G(new Set(r)))};
g.W(UdY,Hk);UdY.prototype.X=function(){var r=[];this.W.entryCollection&&r.push(this.W.entryCollection);return[].concat(g.G(new Set(r)))};
g.W(Fpq,Bk);Fpq.prototype.X=function(){var r=[];this.W.video&&r.push(this.W.video);return[].concat(g.G(new Set(r)))};
g.W(Y18,Hk);Y18.prototype.X=function(){var r=[];this.W.parentPlaylist&&r.push(this.W.parentPlaylist);if(this.W.entries)for(var l=g.Q(this.W.entries),U=l.next();!U.done;U=l.next())r.push.apply(r,g.G((new Fpq(U.value)).X()));return[].concat(g.G(new Set(r)))};
g.W(ejY,Hk);ejY.prototype.X=function(){var r=[];this.W.descriptionEntity&&r.push(this.W.descriptionEntity);this.W.creators&&r.push.apply(r,g.G(this.W.creators));this.W.theBiggestFan&&r.push(this.W.theBiggestFan);return[].concat(g.G(new Set(r)))};
g.W(dd8,Hk);dd8.prototype.X=function(){return[]};
g.W(OGC,Hk);OGC.prototype.X=function(){return[]};
g.W(Kpf,Hk);Kpf.prototype.X=function(){return[]};
g.W(C$Y,Hk);C$Y.prototype.X=function(){return[]};
g.W(vAC,Hk);vAC.prototype.X=function(){return[]};
g.W(JgY,Hk);JgY.prototype.X=function(){return[]};
g.W(mdY,Hk);mdY.prototype.X=function(){return[]};
g.W(P$Y,Hk);P$Y.prototype.X=function(){return[]};
g.W(AgY,Hk);AgY.prototype.X=function(){return[]};
g.W(Me8,Hk);Me8.prototype.X=function(){var r=[];this.W.downloadsList&&r.push(this.W.downloadsList);this.W.smartDownloadsList&&r.push(this.W.smartDownloadsList);this.W.recommendedDownloadsList&&r.push(this.W.recommendedDownloadsList);this.W.refresh&&r.push(this.W.refresh);return[].concat(g.G(new Set(r)))};
g.W(sr0,Bk);sr0.prototype.X=function(){var r=[];this.W.video&&r.push(this.W.video);this.W.playlist&&r.push(this.W.playlist);this.W.videoItem&&r.push(this.W.videoItem);this.W.playlistItem&&r.push(this.W.playlistItem);return[].concat(g.G(new Set(r)))};
g.W(xdq,Hk);xdq.prototype.X=function(){var r=[];this.W.refresh&&r.push(this.W.refresh);if(this.W.downloads)for(var l=g.Q(this.W.downloads),U=l.next();!U.done;U=l.next())r.push.apply(r,g.G((new sr0(U.value)).X()));return[].concat(g.G(new Set(r)))};
g.W(WpC,Hk);WpC.prototype.X=function(){var r=[];this.W.localImageEntities&&r.push.apply(r,g.G(this.W.localImageEntities));return[].concat(g.G(new Set(r)))};
g.W(Qrq,Hk);Qrq.prototype.X=function(){var r=[];this.W.playbackData&&r.push(this.W.playbackData);this.W.localImageEntities&&r.push.apply(r,g.G(this.W.localImageEntities));this.W.videoDownloadContextEntity&&r.push(this.W.videoDownloadContextEntity);return[].concat(g.G(new Set(r)))};
g.W(EAY,Hk);EAY.prototype.X=function(){return[]};
g.W(ZGb,Hk);ZGb.prototype.X=function(){var r=[];this.W.fakeChildren&&r.push.apply(r,g.G(this.W.fakeChildren));return[].concat(g.G(new Set(r)))};
g.W(Rj8,Hk);Rj8.prototype.X=function(){var r=[];this.W.video&&r.push(this.W.video);this.W.playbackData&&r.push(this.W.playbackData);this.W.offlineVideoPolicy&&r.push(this.W.offlineVideoPolicy);return[].concat(g.G(new Set(r)))};
g.W(hjr,Hk);hjr.prototype.X=function(){return[]};
g.W(nAC,Hk);nAC.prototype.X=function(){var r=[];this.W.channelOwner&&r.push(this.W.channelOwner);this.W.videos&&r.push.apply(r,g.G(this.W.videos));this.W.collaboratorChannels&&r.push.apply(r,g.G(this.W.collaboratorChannels));this.W.downloadState&&r.push(this.W.downloadState);this.W.refresh&&r.push(this.W.refresh);return[].concat(g.G(new Set(r)))};
g.W(G$C,Hk);G$C.prototype.X=function(){var r=[];this.W.video&&r.push(this.W.video);this.W.channelContributor&&r.push(this.W.channelContributor);return[].concat(g.G(new Set(r)))};
g.W(X0r,Bk);X0r.prototype.X=function(){var r=[];this.W.localImageEntities&&r.push.apply(r,g.G(this.W.localImageEntities));this.W.videoDownloadContextEntity&&r.push(this.W.videoDownloadContextEntity);return[].concat(g.G(new Set(r)))};
g.W(iGC,Bk);iGC.prototype.X=function(){var r=[];this.W.recommendedVideoMetadata&&r.push.apply(r,g.G((new X0r(this.W.recommendedVideoMetadata)).X()));return[].concat(g.G(new Set(r)))};
g.W(bGY,Bk);bGY.prototype.X=function(){var r=[];this.W.playbackPosition&&r.push(this.W.playbackPosition);return[].concat(g.G(new Set(r)))};
g.W(NY0,Hk);NY0.prototype.X=function(){var r=[];this.W.owner&&r.push(this.W.owner);this.W.downloadState&&r.push(this.W.downloadState);this.W.userState&&r.push.apply(r,g.G((new bGY(this.W.userState)).X()));this.W.additionalMetadata&&r.push.apply(r,g.G((new iGC(this.W.additionalMetadata)).X()));return[].concat(g.G(new Set(r)))};
g.W(jr0,Hk);jr0.prototype.X=function(){var r=[];this.W.userChannelDetails&&r.push(this.W.userChannelDetails);return[].concat(g.G(new Set(r)))};
g.W(q18,Hk);q18.prototype.X=function(){var r=[];this.W.channelOwner&&r.push(this.W.channelOwner);this.W.playbackPosition&&r.push(this.W.playbackPosition);this.W.localImageEntities&&r.push.apply(r,g.G(this.W.localImageEntities));this.W.downloadStatus&&r.push(this.W.downloadStatus);return[].concat(g.G(new Set(r)))};
g.W(TYf,Hk);TYf.prototype.X=function(){return[]};
g.W(uBf,Hk);uBf.prototype.X=function(){return[]};
g.W(ygY,Hk);ygY.prototype.X=function(){return[]};
g.W(BYj,Hk);BYj.prototype.X=function(){return[]};
g.W(HGr,Hk);HGr.prototype.X=function(){return[]};
g.W(gAj,Hk);gAj.prototype.X=function(){return[]};
g.W(w0p,Hk);w0p.prototype.X=function(){return[]};
g.W(Dd8,Hk);Dd8.prototype.X=function(){return[]};
g.W(VeY,Hk);VeY.prototype.X=function(){return[]};
g.W(fwC,Hk);fwC.prototype.X=function(){return[]};
g.W(S1$,Hk);S1$.prototype.X=function(){return[]};
g.W(zjG,Hk);zjG.prototype.X=function(){return[]};
g.W(p0p,Hk);p0p.prototype.X=function(){var r=[];this.W.trackDownloadMetadatas&&r.push.apply(r,g.G(this.W.trackDownloadMetadatas));return[].concat(g.G(new Set(r)))};
g.W(teb,Hk);
teb.prototype.X=function(){var r=[];this.W.downloadedTracks&&r.push.apply(r,g.G(this.W.downloadedTracks));this.W.smartDownloadedTracks&&r.push.apply(r,g.G(this.W.smartDownloadedTracks));this.W.downloadedEpisodes&&r.push.apply(r,g.G(this.W.downloadedEpisodes));this.W.downloadedAlbumReleases&&r.push.apply(r,g.G(this.W.downloadedAlbumReleases));this.W.smartDownloadedAlbumReleases&&r.push.apply(r,g.G(this.W.smartDownloadedAlbumReleases));this.W.downloadedPlaylists&&r.push.apply(r,g.G(this.W.downloadedPlaylists));this.W.smartDownloadedPlaylists&&
r.push.apply(r,g.G(this.W.smartDownloadedPlaylists));this.W.metadataOnlyTracks&&r.push.apply(r,g.G(this.W.metadataOnlyTracks));return[].concat(g.G(new Set(r)))};
g.W(LpC,Hk);LpC.prototype.X=function(){var r=[];this.W.trackDownloadMetadatas&&r.push.apply(r,g.G(this.W.trackDownloadMetadatas));return[].concat(g.G(new Set(r)))};
g.W(cgq,Hk);cgq.prototype.X=function(){var r=[];this.W.playbackData&&r.push(this.W.playbackData);this.W.localImageEntities&&r.push.apply(r,g.G(this.W.localImageEntities));this.W.videoDownloadContextEntity&&r.push(this.W.videoDownloadContextEntity);return[].concat(g.G(new Set(r)))};
g.W(aw8,Hk);aw8.prototype.X=function(){var r=[];this.W.musicLibraryStatusEntity&&r.push(this.W.musicLibraryStatusEntity);this.W.primaryArtists&&r.push.apply(r,g.G(this.W.primaryArtists));this.W.details&&r.push(this.W.details);this.W.userDetails&&r.push(this.W.userDetails);this.W.tracks&&r.push.apply(r,g.G(this.W.tracks));this.W.share&&r.push(this.W.share);this.W.downloadMetadata&&r.push(this.W.downloadMetadata);this.W.refresh&&r.push(this.W.refresh);return[].concat(g.G(new Set(r)))};
g.W(IwC,Hk);IwC.prototype.X=function(){var r=[];this.W.albumRelease&&r.push(this.W.albumRelease);this.W.tracks&&r.push.apply(r,g.G(this.W.tracks));return[].concat(g.G(new Set(r)))};
g.W(k$p,Hk);k$p.prototype.X=function(){var r=[];this.W.albumRelease&&r.push(this.W.albumRelease);return[].concat(g.G(new Set(r)))};
g.W(onR,Hk);onR.prototype.X=function(){var r=[];this.W.details&&r.push(this.W.details);this.W.userDetails&&r.push(this.W.userDetails);return[].concat(g.G(new Set(r)))};
g.W(r40,Hk);r40.prototype.X=function(){var r=[];this.W.parentArtist&&r.push(this.W.parentArtist);return[].concat(g.G(new Set(r)))};
g.W($DG,Hk);$DG.prototype.X=function(){var r=[];this.W.parentArtist&&r.push(this.W.parentArtist);return[].concat(g.G(new Set(r)))};
g.W(lgp,Hk);lgp.prototype.X=function(){return[]};
g.W(UD0,Hk);UD0.prototype.X=function(){return[]};
g.W(FCj,Bk);FCj.prototype.X=function(){var r=[];this.W.creatorEntity&&r.push(this.W.creatorEntity);return[].concat(g.G(new Set(r)))};
g.W(YKC,Hk);
YKC.prototype.X=function(){var r=[];this.W.tracks&&r.push.apply(r,g.G(this.W.tracks));this.W.refresh&&r.push(this.W.refresh);this.W.musicLibraryStatusEntity&&r.push(this.W.musicLibraryStatusEntity);this.W.details&&r.push(this.W.details);this.W.downloadMetadata&&r.push(this.W.downloadMetadata);this.W.sideloadMetadata&&r.push(this.W.sideloadMetadata);this.W.userDetails&&r.push(this.W.userDetails);this.W.entryCollection&&r.push(this.W.entryCollection);this.W.share&&r.push(this.W.share);this.W.podcastShowAdditionalMetadata&&r.push.apply(r,
g.G((new FCj(this.W.podcastShowAdditionalMetadata)).X()));return[].concat(g.G(new Set(r)))};
g.W(eEj,Hk);eEj.prototype.X=function(){return[]};
g.W(dDp,Hk);
dDp.prototype.X=function(){var r=[];this.W.musicLibraryStatusEntity&&r.push(this.W.musicLibraryStatusEntity);this.W.artists&&r.push.apply(r,g.G(this.W.artists));this.W.audioModeVersion&&r.push(this.W.audioModeVersion);this.W.videoModeVersion&&r.push(this.W.videoModeVersion);this.W.userDetails&&r.push(this.W.userDetails);this.W.details&&r.push(this.W.details);this.W.albumRelease&&r.push(this.W.albumRelease);this.W.share&&r.push(this.W.share);this.W.libraryEdit&&r.push(this.W.libraryEdit);this.W.downloadMetadata&&
r.push(this.W.downloadMetadata);this.W.playbackPosition&&r.push(this.W.playbackPosition);this.W.lyrics&&r.push(this.W.lyrics);return[].concat(g.G(new Set(r)))};
g.W(O9C,Hk);O9C.prototype.X=function(){var r=[];this.W.parentTrack&&r.push(this.W.parentTrack);return[].concat(g.G(new Set(r)))};
g.W(KCG,Hk);KCG.prototype.X=function(){var r=[];this.W.parentTrack&&r.push(this.W.parentTrack);return[].concat(g.G(new Set(r)))};
g.W(CMC,Hk);CMC.prototype.X=function(){return[]};
g.W(vn$,Hk);vn$.prototype.X=function(){return[]};
g.W(J4R,Hk);J4R.prototype.X=function(){return[]};
g.W(mDq,Hk);mDq.prototype.X=function(){return[]};
g.W(PMC,Hk);PMC.prototype.X=function(){var r=[];this.W.transfer&&r.push(this.W.transfer);this.W.adsPlaybackData&&r.push.apply(r,g.G(this.W.adsPlaybackData));this.W.drmLicense&&r.push(this.W.drmLicense);this.W.offlineVideoPolicy&&r.push(this.W.offlineVideoPolicy);this.W.videoDownloadContextEntity&&r.push(this.W.videoDownloadContextEntity);return[].concat(g.G(new Set(r)))};
g.W(A4C,Hk);A4C.prototype.X=function(){return[]};
g.W(MHb,Hk);MHb.prototype.X=function(){var r=[];this.W.offlineVideoStreams&&r.push.apply(r,g.G(this.W.offlineVideoStreams));this.W.captionTrack&&r.push.apply(r,g.G(this.W.captionTrack));return[].concat(g.G(new Set(r)))};
g.W(sbR,Hk);sbR.prototype.X=function(){return[]};
g.W(xDb,Hk);xDb.prototype.X=function(){return[]};
g.W(WCG,Hk);WCG.prototype.X=function(){return[]};
g.W(QbY,Hk);QbY.prototype.X=function(){return[]};
g.W(En0,Hk);En0.prototype.X=function(){return[]};
g.W(Z98,Hk);Z98.prototype.X=function(){return[]};
g.W(REf,Hk);REf.prototype.X=function(){return[]};
g.W(hE8,Hk);hE8.prototype.X=function(){return[]};
g.W(nnG,Hk);nnG.prototype.X=function(){return[]};
g.W(Ga8,Hk);Ga8.prototype.X=function(){return[]};
g.W(Xop,Hk);Xop.prototype.X=function(){return[]};
g.W(i9C,Hk);i9C.prototype.X=function(){return[]};
g.W(b90,Hk);b90.prototype.X=function(){return[]};
g.W(NJf,Hk);NJf.prototype.X=function(){return[]};
g.W(jb0,Hk);jb0.prototype.X=function(){return[]};
g.W(qKY,Hk);qKY.prototype.X=function(){return[]};
g.W(TJp,Hk);TJp.prototype.X=function(){return[]};
g.W(uf$,Hk);uf$.prototype.X=function(){return[]};
g.W(y40,Hk);y40.prototype.X=function(){return[]};
g.W(BJr,Hk);BJr.prototype.X=function(){return[]};
g.W(H9Y,Hk);H9Y.prototype.X=function(){return[]};
var BcG=["browse","music/browse","unplugged/browse"],V6R=["offline/playlist_sync_check"],Xsj=["offline"],H0f=["offline/offline_video_playback_position_sync"],wsf=["offline/get_playback_data_entity"],gt;wt.getInstance=function(){return g.y(function(r){return r.return(new Promise(function(l){g.eJ().then(function(U){U?(wt.instance||(wt.instance=new wt(U)),l(wt.instance)):l(void 0)})}))})};
wt.prototype.get=function(r){var l=this,U,F,Y;return g.y(function(e){if(e.X==1)return g.T(e,VHC(l.token),2);if(e.X!=3)return U=e.W,g.T(e,U.get("prefs",r),3);F=e.W;if(!F)return e.return();Y=(0,g.f)();return F.expirationTimestampMs<=Y?e.return():e.return(F.value)})};
wt.prototype.set=function(r,l,U){U=U===void 0?31536E3:U;var F=this,Y,e,d;return g.y(function(K){if(K.X==1)return Y=(0,g.f)(),e={key:r,value:l,expirationTimestampMs:Y+U*1E3},g.T(K,VHC(F.token),2);d=K.W;return g.T(K,g.Vc(d,"prefs",e),0)})};
wt.prototype.remove=function(r){var l=this,U;return g.y(function(F){if(F.X==1)return g.T(F,VHC(l.token),2);U=F.W;return g.T(F,U.delete("prefs",r),0)})};
g.W(DZ,g.lY);g.W(V5,tHq);V5.prototype.L=function(r,l){l=c48(l);r=(new TextEncoder).encode(JSON.stringify(r));return this.W.encrypt(r,l)};
V5.prototype.X=function(r,l){if(!(r instanceof Uint8Array))throw fgb(1);var U=new TextDecoder;l=c48(l);r=this.W.decrypt(r,l);return JSON.parse(U.decode(r))};
var ag0={accountLinkStatusEntity:Kpf,booleanEntity:rg8,buttonEntity:NJf,captionTrack:CMC,channelHandle:k9f,chipEntity:REf,commerceAcquisitionClientPayloadEntity:qKY,commerceCartListEntity:TJp,contextNoteFeedEntityPayload:oAr,continuationTokenEntity:hjr,downloadQualityPickerEntity:mdY,downloadsPageRefreshTokenEntity:AgY,downloadsPageViewConfigurationEntity:TYf,downloadStatusEntity:P$Y,dismissState:hE8,sfvAudioItemCurrentlyPlayingEntity:QbY,emojiFountainDataEntity:i9C,emojiCustomizationSetEntity:Xop,
fakeChannel:lwb,fakePlaylist:UdY,fakePlaylistEntryCollection:Y18,fakeVideo:ejY,fakeVideoDescription:dd8,featuredProductsEntity:fwC,flowStateEntity:OGC,iconBadgeEntity:uf$,interstitialInteractionStateEntity:vAC,likeButtonAnimationEntity:uBf,liveChatPollStateEntity:JgY,liveViewerLeaderboardChatEntryPointStateEntity:xDb,liveViewerLeaderboardPointsEntity:WCG,liveReactionsDataEntity:b90,logoEntity:C$Y,macroMarkerEntity:ygY,mainDownloadsLibraryEntity:Me8,mainDownloadsListEntity:xdq,mainPlaylistDownloadStateEntity:WpC,
mainPlaylistEntity:nAC,mainPlaylistVideoEntity:G$C,mainVideoDownloadStateEntity:Qrq,mainVideoEntity:NY0,markersEngagementPanelSyncEntity:BYj,markersVisibilityOverrideEntity:HGr,musicAlbumReleaseDetail:IwC,musicAlbumReleaseDownloadMetadataEntity:p0p,musicAlbumRelease:aw8,musicAlbumReleaseUserDetail:k$p,musicArtistDetail:r40,musicArtist:onR,musicArtistUserDetail:$DG,musicDownloadsLibraryEntity:teb,musicLibraryEdit:lgp,musicLibraryStatusEntity:UD0,musicPlaylist:YKC,musicPlaylistDownloadMetadataEntity:LpC,
musicShare:eEj,musicTrackDetail:O9C,musicTrackDownloadMetadataEntity:cgq,musicTrack:dDp,musicTrackUserDetail:KCG,offlineOrchestrationActionWrapperEntity:vn$,offlineVideoPolicy:J4R,offlineVideoStreams:mDq,offlineabilityEntity:EAY,orchestrationWebSamplingEntity:ZGb,pageHeaderEntity:nnG,pdpStateEntity:y40,pinnedProductEntity:S1$,playbackData:PMC,playerStateEntity:gAj,quantityIncrementerEntity:BJr,refresh:A4C,saveToPlaylistListEntity:En0,selectedChipIndexEntityPayload:w0p,settingEntity:Z98,stringEntity:$d0,
suggestedFeedbackChipStateEntity:Dd8,transfer:MHb,trendingOfferEntity:zjG,videoDownloadContextEntity:sbR,videoOverviewAsyncDataEntity:H9Y,videoPlaybackPositionEntity:jb0,votingEntity:Ga8,ytMainChannelEntity:jr0,youchatPendingResponseEntity:VeY,ytMainDownloadedVideoEntity:Rj8,ytMainVideoEntity:q18};g.W(L_,tHq);L_.prototype.L=function(r){return r};
L_.prototype.X=function(r){if(r instanceof Uint8Array)throw fgb(0);return r};
g.W(ck,g.H);ck.prototype.observe=function(r){var l=this;this.observers.push(r);return function(){var U=l.observers.indexOf(r);U>=0&&l.observers.splice(U,1)}};
ck.prototype.X=function(r){ClG(this,r.data)};
ck.prototype.Rf=function(){this.channel.close()};
var AKR,m_f=new g.uj("elementsCommand");var ho=new g.uj("entityBatchUpdate");var $_$=new g.uj("downloadStatusEntity");var sv0=new g.uj("mainPlaylistEntityActionMetadata");var aA=new g.uj("mainVideoEntityActionMetadata");var Gdb=new g.uj("musicPlaylistEntityActionMetadata");var kbr=new g.uj("musicTrackEntityActionMetadata");var qW8=new g.uj("localImageEntityActionMetadata");var yR=new g.uj("playbackDataActionMetadata");var PuY=new g.uj("transferEntityActionMetadata");var olY=new g.uj("videoPlaybackPositionEntityActionMetadata");var NHY;new g.W$;new g.W$;yKY.prototype.request=function(r,l,U){l=l===void 0?{}:l;return this.locks.request(r,l,function(F){return U(F)})};var U8=g.pP.caches,l6,D80;$O.prototype.open=function(r){return U8.open(gtC(r))};
$O.prototype.has=function(r){return U8.has(gtC(r))};
$O.prototype.delete=function(r){return U8.delete(gtC(r))};
$O.prototype.match=function(r,l){var U=this,F,Y,e,d,K,C;return g.y(function(v){switch(v.X){case 1:return g.T(v,U.keys(),2);case 2:F=v.W,Y=g.Q(F),e=Y.next();case 3:if(e.done){v.FT(5);break}d=e.value;return g.T(v,U.open(d),6);case 6:return K=v.W,g.T(v,K.match(r,l),7);case 7:if(C=v.W)return v.return(C);e=Y.next();v.FT(3);break;case 5:return v.return()}})};
g.W(HxR,$O);HxR.prototype.keys=function(){var r,l,U,F,Y,e,d,K,C;return g.y(function(v){if(v.X==1)return r=[],l=g.Uf("CacheStorage keys"),g.T(v,U8.keys(),2);U=v.W;F=g.Q(U);for(Y=F.next();!Y.done;Y=F.next()){e=Y.value;var J=e.indexOf(":");d=J===-1?{kA:e}:{kA:e.substring(0,J),datasyncId:e.substring(J+1)};K=d.kA;C=d.datasyncId;C===l&&r.push(K)}return v.return(r)})};g.W(YO,g.H);YO.prototype.L=function(r){this.api.PQ("onOfflineOperationFailure",r.data)};
YO.prototype.K=function(r){this.api.publish("offlinetransferpause",r.data)};
YO.prototype.Rf=function(){var r;(r=this.W)==null||r.close();var l;(l=this.X)==null||l.close()};S2p.prototype.W$=function(){this.W&&dx(this)};
S2p.prototype.GQ=function(){this.X&&this.X.resolve();this.L=this.W=!1;this.V()};var NQf=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var CU0="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var Ear="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.W(SeG,q4);SeG.prototype.X=function(r){return vR(r)?t6Y(this,r):Jo(r)?aFp(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};g.W(IFY,q4);IFY.prototype.X=function(r){return Jo(r)?kd8(this,r):rzY(r)?rbj(this,r):mj(r)?$0p(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};g.x=lsr.prototype;g.x.Vcz=function(r){var l=this,U,F,Y,e;return g.y(function(d){if(!g.c(r.state,128))return d.FT(0);U=r.state.TM;var K=(F=U)==null?void 0:F.errorCode,C=(Y=U)==null?void 0:Y.jW;e=K==="net.connect"&&C===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(K==null?0:K.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.T(d,l.SO(l.player.getVideoData().videoId,e),0)})};
g.x.SO=function(r,l){var U=this;return g.y(function(F){if(F.X==1){if(U.X)return F.return();U.X=!0;return l==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(gx(U,r,!1,!0),F.FT(0)):g.T(F,HR(U,r),3)}g.ff(r,4);return g.T(F,U.W.SO(l),0)})};
g.x.NA=function(r){r.status===2?(r.status!==this.L&&(kEf(this.W),g.ff(r.videoId,2)),r.Rt&&UhC(this.W,r.videoId,r.Rt)):r.status===4?(HR(this,r.videoId),this.SO(r.videoId,r.OQ?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):r.status===1&&ly0(this.W);this.L=r.status;this.api.PQ("localmediachange",{videoId:r.videoId,status:r.status})};
g.x.gH=function(){var r=this,l;return g.y(function(U){if(U.X==1){if(r.X)return U.return();r.X=!0;l=r.player.getVideoData().videoId;return g.T(U,HR(r,l),2)}return g.T(U,r.W.gH(),0)})};
g.x.Gh=function(r){switch(r){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.x.Y=function(r){return this.api.N().Y(r)};g.W(KJC,q4);KJC.prototype.X=function(r){return vR(r)?vlR(this,r):Jo(r)?JbC(this,r):rzY(r)?m0$(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};WJ8.prototype.W=function(r,l){var U=r.action.actionMetadata.priority-l.action.actionMetadata.priority;U===0&&(r.W<l.W?U=-1:r.W>l.W&&(U=1));return U};g.W(wx,g.H);wx.prototype.Rf=function(){this.V&&this.V();g.H.prototype.Rf.call(this)};
wx.prototype.createAction=function(r,l){var U=g.QN(r.entityKey).entityType,F=g.qt(16);return new xO(U,F,r,l.actionId,l.rootActionId)};
wx.prototype.sF=function(r){var l=this,U,F,Y,e,d,K,C,v,J;return g.y(function(m){if(m.X==1){if(l.QT())return m.return();F=(U=r.offlineOrchestrationActionWrapperEntity)!=null?U:new Set;Y=[];e=g.Q(F);for(d=e.next();!d.done;d=e.next())K=d.value,C=g.QN(K),v=C.entityId,ZJj(l.W,v)||Y.push(K);return g.T(m,TQ$(l,Y),2)}J=m.W;return g.T(m,qSY(l,J),0)})};
wx.prototype.retry=function(){var r=this;return g.y(function(l){return g.T(l,u1R(r),0)})};BQY.prototype.by=function(r,l){l=l===void 0?!0:l;var U=this,F,Y,e,d,K,C,v,J;return g.y(function(m){switch(m.X){case 1:if(!U.W)return m.return();F=[];Y=g.Yd(U.W.X,l);e=[];for(d={g5:0};d.g5<Y.length;d={g5:d.g5},d.g5++)K=Y[d.g5],C=U.W.T6(K,"json3"),v=g.Hx(C,{withCredentials:!0,format:"RAW"},3,500).then(function(P){return function(A){A={metadata:g.XY(Y[P.g5]),trackData:A.xhr.responseText};e.push(A)}}(d)).zL(function(P){F5("Caption fetch error",P)}),F.push(v);
return g.T(m,Ih8(F),2);case 2:return g.QB(m,3),g.T(m,R78(r,e),5);case 5:g.RR(m,0);break;case 3:J=g.nP(m),F5("Caption DB transaction error",J),g.Wm(m)}})};g.W(Dp,g.H);Dp.prototype.Rf=function(){this.X&&this.X();g.H.prototype.Rf.call(this)};
Dp.prototype.L=function(r){var l=this,U,F,Y,e,d,K,C,v;return g.y(function(J){F=(U=r.transfer)!=null?U:new Set;Y=[];e=g.Q(F);for(d=e.next();!d.done;d=e.next())K=d.value,C=g.QN(K),v=C.entityId,Y.push(v);return Y.length===0?J.return():g.T(J,wl$(l,Y),0)})};g.W(ziY,g.H);g.x=ziY.prototype;g.x.Rf=function(){this.KP&&this.KP();this.rz.dispose();this.K.dispose();this.iG&&g.dJ(this.D.uL,this.iG);this.YN&&g.dJ(this.D.uL,this.YN);g.H.prototype.Rf.call(this)};
g.x.OJN=function(r){var l=this,U,F,Y;return g.y(function(e){switch(e.X){case 1:U=g.Ea(r,"transfer");if(l.W&&U===l.W.key){gx(l.j,l.U,!0);l.K.stop();e.FT(0);break}return g.T(e,as(l.X,{mode:"readwrite",ag:!0},function(d){return f_(d,U,"transfer").then(function(K){if(K&&K.transferState!=="TRANSFER_STATE_COMPLETE"&&K.transferState!=="TRANSFER_STATE_FAILED")return K.transferState="TRANSFER_STATE_PAUSED_BY_USER",p_(d,K,"transfer").then(function(){return K})})}),3);
case 3:F=e.W;if(!F){e.FT(0);break}if(!r||!l.L){e.FT(5);break}return g.T(e,PR(r,l.L,l.X,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.T(e,SC(l,r),7);case 7:Y=e.W,kVq({videoId:r,cj:F,offlineModeType:Y}),g.Wm(e)}})};
g.x.acf=function(){var r=this;if(this.W&&this.U){gx(this.j,this.U,!1);var l=this.W,U=(l==null?0:l.key)?g.QN(l.key).entityId:"";U&&this.L&&(new Promise(function(F,Y){PR(U,r.L,r.X,"DOWNLOAD_STATE_PAUSED").catch(function(e){Y(e)})})).catch(function(F){F5("Download state setting error",F)})}this.K.stop()};
g.x.Mm=function(){this.W?LJ$(this,this.W):fq(this)};
g.x.FX=function(r){var l=this;return g.y(function(U){switch(U.X){case 1:if(!l.W){U.FT(2);break}if(l.W.transferState==="TRANSFER_STATE_COMPLETE"||l.W.transferState==="TRANSFER_STATE_FAILED"||!r.transfer||!r.transfer.has(l.W.key)){U.FT(3);break}return g.T(U,kG(l.X,l.W.key,"transfer"),4);case 4:l.W=U.W;if(l.W){U.FT(3);break}return g.T(U,cbb(l),3);case 3:if(l.W)return U.return();case 2:return g.T(U,fq(l),0)}})};
g.x.SO=function(r,l){var U=this,F,Y,e,d,K;return g.y(function(C){switch(C.X){case 1:if(!U.W){zX(U,"onTransferFailure: "+r);C.FT(2);break}F=U.W;e=((Y=F)==null?0:Y.key)?g.QN(F.key).entityId:"";a:switch(r){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var v=!1;break a;default:v=!0}return v&&FZG(U)?g.T(C,pq(U,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.T(C,
YWY(U,r),5);case 5:if(!e||!U.L){C.FT(2);break}return g.T(C,PR(e,U.L,U.X,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.T(C,SC(U,e),9);case 9:d=C.W;Kq({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:e,cj:F,offlineModeType:d});if(!e||!U.L){C.FT(2);break}return g.T(C,PR(e,U.L,U.X,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:VR(U),K=fq(U,!0),l&&l(K),g.Wm(C)}})};
g.x.gH=function(r){var l=this,U,F,Y,e,d,K,C,v,J,m,P,A;return g.y(function(M){switch(M.X){case 1:if(!l.W){zX(l,"onMaybeTransferStreamsExpired");M.FT(2);break}return FZG(l)?g.T(M,pq(l,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.T(M,YWY(l,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!l.L){M.FT(2);break}U=l.W;Y=((F=U)==null?0:F.key)?g.QN(U.key).entityId:"";if(!Y){M.FT(2);break}return g.T(M,PR(Y,l.L,l.X,"DOWNLOAD_STATE_FAILED"),2);case 9:return l.W||zX(l,"onMaybeTransferStreamsExpiredRetryAttempting"),
e=l.W,K=((d=e)==null?0:d.key)?g.QN(e.key).entityId:"",g.T(M,SC(l,K),10);case 10:return C=M.W,Kq({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:K,cj:e,offlineModeType:C}),v=FQp(),g.I3(v,yR,{isEnqueuedForExpiredStreamUrlRefetch:!0}),J=g.Ea(K,"playbackData"),m={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:J,actionMetadata:v},P=QR(new xO("playbackData",K,m)),g.T(M,Is(l.X,P,"offlineOrchestrationActionWrapperEntity"),2);case 2:VR(l),A=fq(l,!0),
r&&r(A),g.Wm(M)}})};
var KzY={},eXb=(KzY.TRANSFER_STATE_TRANSFERRING=1,KzY.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,KzY);g.x=to.prototype;g.x.cF=function(){return this.U.promise};
g.x.m2=function(){if(this.X&&this.j)return this.U.promise;KZY(this).then(this.U.resolve).catch(this.U.reject);return this.U.promise};
g.x.rD=function(r){var l={};return l.playbackData=new SeG(r,this.WQ,this.W),l.transfer=new KJC(r,this.WQ),l.videoPlaybackPositionEntity=new IFY(r,this.WQ),l};
g.x.Fw=function(){var r=this;return g.y(function(l){return r.X?g.T(l,plj(r.X),0):l.FT(0)})};
g.x.kS=function(){var r=this,l,U;return g.y(function(F){if(F.X==1)return r.X||r.j?g.T(F,r.cF(),2):F.return();r.T!==void 0&&(g.Gj(r.T),r.T=void 0);r.K!==void 0&&(g.Gj(r.K),r.K=void 0);(l=r.X)==null||l.dispose();r.X=void 0;(U=r.j)==null||U.dispose();r.j=void 0;r.api.PQ("onOrchestrationLostLeader");r.U=new g.W$;g.Wm(F)})};
g.x.isOrchestrationLeader=function(){return this.L.W};
g.x.eY=function(){return g.y(function(r){return r.return(!1)})};
g.x.aQ=function(r){var l=this.W;l.api.publish("offlinetransferpause",r);var U;(U=l.X)==null||U.postMessage(r)};
g.x.Mm=function(r){var l,U;return g.y(function(F){if(F.X==1)return g.T(F,rx(),2);l=F.W;if(!l)return F.return();U=g.Ea(r,"transfer");return g.T(F,as(l,{mode:"readwrite",ag:!0},function(Y){var e=f_(Y,U,"transfer"),d=f_(Y,g.Ea(r,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.qZ.all([e,d]).then(function(K){K=g.Q(K);var C=K.next().value;var v=K.next().value;return C&&C.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(C.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",p_(Y,C,"transfer").then(function(){Kq({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:r,cj:C,offlineModeType:v==null?void 0:v.offlineModeType});return g.qZ.resolve(null)})):g.qZ.resolve(null)})}),0)})};
g.x.oQ=function(r){r=r===void 0?43200:r;var l=this,U,F,Y,e,d,K,C,v;return g.y(function(J){if(J.X==1)return l.D.i6()?g.T(J,rx(),2):J.return(Cj0());if(J.X!=3){U=J.W;if(!U)return J.return([]);F=Date.now()/1E3;return g.T(J,oA(U,"offlineVideoPolicy"),3)}Y=J.W;e=[];d=g.Q(Y);for(K=d.next();!K.done;K=d.next())C=K.value,Number(C.lastUpdatedTimestampSeconds)+r<=F&&(v=g.QN(C.key).entityId,e.push(v));return e.length?J.return(Lq(l,e,l.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):J.return([])})};
g.x.deleteAll=function(){return Lq(this,["!*$_ALL_ENTITIES_!*$"],this.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.x.refreshAllStaleEntities=function(r){var l=this;return g.y(function(U){return U.X==1?g.T(U,l.oQ(r),2):U.return(U.W)})};
g.x.setUpPositionSyncInterval=function(r){var l=this;this.K!==void 0&&(g.Gj(this.K),this.K=void 0);var U=r!=null?r:864E5;this.K=g.hZ(function(){l.e3(U)},U)};
g.x.e3=function(r){var l=this,U,F,Y,e,d,K;return g.y(function(C){switch(C.X){case 1:return g.QB(C,2),g.T(C,wt.getInstance(),4);case 4:U=C.W;if(!U)throw Error("prefStorage is undefined");return g.T(C,U.get("psi"),5);case 5:F=C.W;e=((Y=F)==null?0:Y.R5)?Number(F.R5)/1E3:0;d=Date.now();if(!(e+r<=d)){C.FT(6);break}return g.T(C,Lq(l,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.RR(C,0);break;case 2:K=g.nP(C),F5("Offline manager error",K),
g.Wm(C)}})};
g.x.Lz=function(){var r=this,l,U,F,Y,e,d,K;return g.y(function(C){if(C.X==1)return g.T(C,rx(),2);if(C.X!=3)return(l=C.W)?g.T(C,oA(l,"transfer"),3):C.return([]);U=C.W;F=[];Y=g.Q(U);for(e=Y.next();!e.done;e=Y.next())d=e.value,d.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&d.key&&(K=g.QN(d.key).entityId,F.push(K));return C.return(JTC(r,F))})};
g.x.xJ=function(){return g.y(function(r){return r.return([])})};
g.x.ZU=function(){return g.y(function(r){g.Wm(r)})};
g.x.E7=function(){return g.y(function(r){g.Wm(r)})};g.W(mhY,q4);mhY.prototype.X=function(r){return vR(r)?Mwq(this,r):Jo(r)?xhp(this,r):mj(r)?WZ$(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var cR=[10];g.W(hXY,q4);hXY.prototype.X=function(r){return vR(r)?XOp(this,r):Jo(r)?iHf(this,r):mj(r)?bHf(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var Gbf=[10];g.W(jv$,q4);jv$.prototype.X=function(r){return Jo(r)?TX$(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};g.W(uXp,to);g.x=uXp.prototype;g.x.rD=function(r){var l=to.prototype.rD.call(this,r);l.mainVideoEntity=new hXY(r,this.WQ,this.W);l.mainPlaylistEntity=new mhY(r,this.WQ,this.W);l.mainDownloadsListEntity=new jv$(r,this.WQ,this.W);return l};
g.x.refreshAllStaleEntities=function(r,l){var U=this,F,Y,e,d,K,C,v,J,m,P,A;return g.y(function(M){switch(M.X){case 1:F=[];if(!U.WQ.Y("web_player_offline_playlist_auto_refresh")){M.FT(2);break}return g.T(M,yT0(U,r,l),3);case 3:F=M.W;case 2:return g.T(M,wt.getInstance(),4);case 4:return Y=M.W,g.T(M,(e=Y)==null?void 0:e.get("sdois"),5);case 5:return d=M.W,g.T(M,(K=Y)==null?void 0:K.get("lmqf"),6);case 6:C=M.W;if(!d){M.FT(7);break}J=F;m=J.concat;return g.T(M,BXr(U,d,(v=C)!=null?v:"SD",r===0),8);case 8:F=
m.call(J,M.W);case 7:return P=F,A=P.concat,g.T(M,to.prototype.refreshAllStaleEntities.call(U,r,l),9);case 9:return F=A.call(P,M.W),M.return(F)}})};
g.x.eY=function(r){var l,U,F,Y,e,d,K,C;return g.y(function(v){if(v.X==1)return g.T(v,rx(),2);if(v.X!=3)return(l=v.W)?g.T(v,kG(l,g.DS,"mainDownloadsListEntity"),3):v.return(!1);U=v.W;if((F=U)==null?0:(Y=F.downloads)==null?0:Y.length)for(e=g.Ea(r,"mainVideoEntity"),d=g.Q(U.downloads),K=d.next();!K.done;K=d.next())if(C=K.value,C.videoItem===e)return v.return(!0);return v.return(!1)})};
g.x.xJ=function(){var r=this,l,U,F,Y,e,d,K,C;return g.y(function(v){if(v.X==1)return g.T(v,rx(),2);if(v.X!=3)return(l=v.W)?g.T(v,oA(l,"downloadStatusEntity"),3):v.return([]);U=v.W;F=[];Y=g.Q(U);for(e=Y.next();!e.done;e=Y.next())d=e.value,d.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&d.key&&(K=g.QN(d.key).entityId,F.push(K));return F.length?(C={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},v.return(Lq(r,F,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
C))):v.return([])})};
g.x.E7=function(){var r;return g.y(function(l){return l.X==1?g.T(l,rx(),2):(r=l.W)?g.T(l,as(r,{mode:"readwrite",ag:!0},function(U){return SO(U,"mainVideoEntity").then(function(F){var Y=[];F=g.Q(F);for(var e=F.next();!e.done;e=F.next()){e=e.value;var d=void 0;(d=e.userState)!=null&&d.playbackPosition||(d=g.QN(e.key).entityId,d={key:g.Ea(d,"videoPlaybackPositionEntity"),videoId:d,lastPlaybackPositionSeconds:"0"},Y.push(p_(U,d,"videoPlaybackPositionEntity")),e.userState={playbackPosition:d.key},Y.push(p_(U,
e,"mainVideoEntity")))}return g.qZ.all(Y)})}),0):l.return()})};
g.x.ZU=function(){var r,l,U,F,Y,e,d,K,C,v,J,m,P,A,M,E,Z,n,h,N,u,D,t,z,I,U4,$$,Y$,L,Ae,G3,z3,RY,dR,XL,he,$0,R;return g.y(function(d4){if(d4.X==1)return g.T(d4,rx(),2);if(d4.X!=3){r=d4.W;if(!r)return d4.return();l=g.Ea("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.T(d4,as(r,{mode:"readonly",ag:!0},function(zp){return g.qZ.all([f_(zp,l,"mainDownloadsListEntity"),f_(zp,g.DS,"mainDownloadsListEntity"),SO(zp,"mainVideoEntity"),SO(zp,"mainPlaylistEntity")])}),3)}U=d4.W;
F=g.Q(U);Y=F.next().value;e=F.next().value;d=F.next().value;K=F.next().value;C=Y;v=e;J=d;m=K;P=new Set;if((A=C)==null?0:(M=A.downloads)==null?0:M.length)for(E=g.Q(C.downloads),Z=E.next();!Z.done;Z=E.next())n=Z.value,h=void 0,(N=(h=n.videoItem)!=null?h:n.playlistItem)&&P.add(N);if((u=v)==null?0:(D=u.downloads)==null?0:D.length)for(t=g.Q(v.downloads),z=t.next();!z.done;z=t.next())I=z.value,I.videoItem&&P.add(I.videoItem);U4=new Set;$$=[];Y$=g.Q(m);for(L=Y$.next();!L.done;L=Y$.next()){Ae=L.value;if(Ae.videos)for(G3=
g.Q(Ae.videos),z3=G3.next();!z3.done;z3=G3.next())RY=z3.value,(dR=JSON.parse(g.QN(RY).entityId).videoId)&&U4.add(dR);Ae.key&&!P.has(Ae.key)&&$$.push(Ae.key)}XL=g.Q(J);for(he=XL.next();!he.done;he=XL.next())$0=he.value,$0.key&&!P.has($0.key)&&(R=g.QN($0.key).entityId,U4.has(R)||$$.push($0.key));return $$.length?g.T(d4,sNb(r,$$),0):d4.FT(0)})};g.W(HHp,q4);HHp.prototype.X=function(r){return vR(r)?wOb(this,r):Jo(r)?DhC(this,r):mj(r)?Vw$(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var IA=[10];g.W(SWq,q4);SWq.prototype.X=function(r){return vR(r)?pOj(this,r):Jo(r)?tw$(this,r):mj(r)?LZp(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var kO=[10];g.W(IyY,q4);IyY.prototype.X=function(r){return vR(r)?$3C(this,r):Jo(r)?lib(this,r):mj(r)?U3r(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var rZq=[10];g.W(oG,to);oG.prototype.rD=function(r){var l=to.prototype.rD.call(this,r);l.musicTrack=new IyY(r,this.W);l.musicPlaylist=new SWq(r,this.W);l.musicAlbumRelease=new HHp(r,this.W);return l};
oG.prototype.refreshAllStaleEntities=function(r,l){var U=this,F,Y,e;return g.y(function(d){if(d.X==1)return g.T(d,YmY(U,r,l),2);if(d.X!=3)return Y=F=d.W,e=Y.concat,g.T(d,to.prototype.refreshAllStaleEntities.call(U,r,l),3);F=e.call(Y,d.W);return d.return(F)})};g.W(e_Y,g.Rf);g.x=e_Y.prototype;g.x.create=function(){var r=this;g.w(this,this.events);if(g.Oi(this.WQ))this.W=new uXp(this.WQ,this.player);else if(g.aL(this.WQ)||g.Jh(this.WQ)==="WEB_MUSIC_INTEGRATIONS")this.W=new oG(this.WQ,this.player);this.events.G(this.player,"onPlaybackStartExternal",function(){r.S1()});
this.events.G(this.player,"videodatachange",function(){r.S1()});
this.WQ.Y("html5_offline_playback_position_sync")&&this.events.G(this.player,"presentingplayerstatechange",this.dF)};
g.x.bL=function(){return!1};
g.x.N1=function(r,l,U,F){var Y=this;return g.y(function(e){return Y.W?e.return(Lq(Y.W,r,l,U,F)):e.return(Promise.reject())})};
g.x.deleteAll=function(){return this.W.deleteAll()};
g.x.oQ=function(r){return this.W.oQ(r)};
g.x.refreshAllStaleEntities=function(r){return this.W.refreshAllStaleEntities(r)};
g.x.setUpPositionSyncInterval=function(r){this.W.setUpPositionSyncInterval(r)};
g.x.aQ=function(r){this.W.aQ(r)};
g.x.Mm=function(r){return this.W.Mm(r)};
g.x.S1=function(){var r=this,l;return g.y(function(U){l=r.player.getVideoData();return g.lT(l)?d3C(l)&&r.X!==l.clientPlaybackNonce?g.T(U,O1f(r,l),0):U.FT(0):U.return()})};
g.x.dF=function(r){var l=this,U,F,Y,e,d,K,C;return g.y(function(v){if(v.X==1)return U=l.player.getVideoData(),F=U.JB,g.Xr(r,2)||g.Xr(r,512)?g.T(v,rx(),2):v.return();if(v.X!=3){Y=v.W;if(!Y)return F5("PES is undefined"),v.return();e=U.videoId;return g.T(v,kG(Y,g.Ea(e,"mainVideoEntity"),"mainVideoEntity"),3)}d=v.W;if(!d)return v.return();K=Math.floor(F).toString();C={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:K}};return g.T(v,l.N1([e],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
C),0)})};
g.x.isOrchestrationLeader=function(){return this.W.isOrchestrationLeader()};
g.x.updateDownloadState=function(r,l){var U,F,Y,e;return g.y(function(d){if(d.X==1)return g.T(d,rx(),2);U=d.W;if(!U)return F5("PES is undefined"),d.return();F=g.QN(r);Y=F.entityType;e=F.entityId;return g.T(d,PR(e,Y,U,l,!0),0)})};g.ZR("offline",e_Y);})(_yt_player);
